var searchTypeUrl=ECS.api.apUrl+"/event/getconfimPlanDefinition";var smallTypeUrl=ECS.api.apUrl+"/event/getAccidentCategory";var searchUrl=ECS.api.rttUrl+"/emergencyEquipment";var exportUrl=ECS.api.rttUrl+"/emergencyEquipment/ExportToExcel";var dept_url=ECS.api.apUrl+"/event/getSecunit";var riskType_url=ECS.api.apUrl+"/event/getRiskArea";var OptRisk_url=ECS.api.apUrl+"/event/getOptRisk";var RiskAnlsObj_url=ECS.api.apUrl+"/event/getRiskAnlsObj";var delUrl=ECS.api.rttUrl+"/emergencyEquipment";var Enterprise_url=ECS.api.rttUrl+"/expert/getExpertTypeEnumList";var inUseUrl=ECS.api.commonUrl+"/getInUse";var bigUrl=ECS.api.bcUrl+"/busiBgCateg/getListByModelID?businessModelId=32";var mUrl=ECS.api.bcUrl+"/busiBgCateg/getListByBgCode";var stockpilePointTypeUrl=ECS.api.rttUrl+"/mtrlStorage/getStoreTypeEnumList";var stockpileTypeUrl=ECS.api.rttUrl+"/mtrlStorage/getRepoTypeEnumList";var grid=null;var flag=false;var enterpriseCode="";var drtDeptCode="";window.pageLoadMode=PageLoadMode.None;$(function(){var a={init:function(){mini.parse();this.bindUI();a.logic.loadType();$("#searchForm")[0].reset();a.logic.initTable()},table:{},bindUI:function(){$("#btnToggle").click(function(){if(flag){flag=!flag;$(this).html('<i class="icon-showMore"></i>');$(".search-unfixed").hide()}else{flag=!flag;$(this).html('<i class="icon-hideMore"></i>');$(".search-unfixed").show()}});$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;a.logic.closeLayer(false)});$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnAdd").click(function(){a.logic.add()});$("#btnImp").click(function(){a.logic.imp()});$("#btnExport").click(function(){var c=ECS.form.getData("searchForm");var b=a.logic.setUrlK(c);window.open(exportUrl+"?"+b)});$("#btnQuery").click(function(){a.logic.search()});$("#btnDel").click(function(){a.logic.delAll()});$("#btnQuery").click(function(){a.logic.search()});$("#businessBgCategID").change(function(b){a.logic.loadmodelType($("#businessBgCategID").val())})},data:{param:{}},logic:{setUrlK:function(f){var d="",b,c;for(var e in f){if(f.hasOwnProperty(e)){b=e}c=f[e];d+="&"+b+"="+encodeURIComponent(c)}return d.substring(1,d.length)},show_editeditAttr:function(){return'<a title="编辑" href="javascript:window.page.logic.editAttr()"><i class="icon-edit edit"></i></a>&nbsp&nbsp<a title="删除" href="javascript:window.page.logic.delAttr()"><i class="icon-delete delete"></i></a>'},editAttr:function(){var b=mini.get("datagrid").getSelected();a.logic.edit(b.emrgEquipID)},delAttr:function(){var c=mini.get("datagrid").getSelected();var b=[];b.push(c.emrgEquipID);layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){$.ajax({url:delUrl+"?emrgequipIds="+c.emrgEquipID,async:true,dataType:"json",timeout:1000,contentType:"application/json;charset=utf-8",type:"DELETE",success:function(d){if(d.isSuccess){layer.msg("删除成功");a.logic.search()}else{layer.msg("删除失败")}},error:function(d){layer.msg(d.responseText)}})},function(d){layer.close(d)})},delAll:function(){var c=new Array();var d=grid.getSelecteds();$.each(d,function(e,f){c.push(f.emrgEquipID)});var b=c.toString(",");if(d.length==0){layer.msg("请选择要删除的数据!");return}layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){$.ajax({url:delUrl+"?emrgequipIds="+c.toString(","),async:false,dataType:"json",contentType:"application/json;charset=utf-8",type:"DELETE",success:function(e){if(e.isSuccess){layer.msg("删除成功");a.logic.search()}else{layer.msg(e.message)}},error:function(e){var f=$.parseJSON(e.responseText);layer.msg(f.collection.error.message)}})},function(e){layer.close(e)})},getEnterpriseType:function(){$("#equIpOwner").html('<option value="" selected="selected">可输入</option>');var b=[{text:"队伍",id:1},{text:"企业",id:2}];$("#equIpOwner").select2({tags:false,data:b,language:{noResults:function(c){return"没有匹配项"}},})},loadType:function(b){a.logic.getEnterpriseType();ECS.ui.getComboSelects(searchTypeUrl,"planDefinition","id","name",false);ECS.ui.getComboSelects(smallTypeUrl,"smallIds","accidentTypeID","accidentTypeName",false);ECS.ui.getComboSelects(dept_url,"enterpriseCode","drtDeptCode","drtDeptName",false);ECS.ui.getComboSelects(bigUrl,"businessBgCategID","businessBgCategCode","businessBgCategName",false);ECS.ui.getComboSelects(stockpilePointTypeUrl,"stockpilePointType","key","value",false);ECS.ui.getComboSelects(stockpileTypeUrl,"stockpileType","key","value",false);ECS.ui.getComboSelects("","businessMdCategID","businessMdCategCode","businessMdCategName",false);ECS.ui.getCombobox("inUse",inUseUrl,{selectValue:"-1",data:{isAll:true}},null)},loadmodelType:function(b){ECS.ui.getComboSelects(mUrl+"?businessBgCategCode="+b,"businessMdCategID","businessMdCategCode","businessMdCategName",false)},initTable:function(){a.logic.search()},search:function(b){a.data.param=ECS.form.getData("searchForm");grid=mini.get("datagrid");grid.set({url:searchUrl,ajaxType:"get",dataField:"pageList"});grid.load(a.data.param)},add:function(){var b=PageModelEnum.NewAdd;var c="应急装备新增";a.logic.detail(c,"",b)},edit:function(b){var c=PageModelEnum.Edit;var d="应急装备编辑";a.logic.detail(d,b,c)},detail:function(e,b,d){var c=grid.getSelected();layer.open({type:2,closeBtn:0,area:["80%","90%"],skin:"new-class",shadeClose:false,title:false,content:"AddOrEdit.html?"+Math.random(),success:function(g,h){var f=layer.getChildFrame("body",h);var j=window[g.find("iframe")[0]["name"]];var i={pageMode:d,title:e};if(d==PageModelEnum.Edit){}j.page.logic.setData(i,c)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){a.logic.search(true);window.pageLoadMode=PageLoadMode.None}else{if(window.pageLoadMode==PageLoadMode.Reload){a.logic.search(true);window.pageLoadMode=PageLoadMode.None}}}})},closeLayer:function(b){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(index)},imp:function(){var c=ECS.api.rttUrl+"/emergencyEquipment/importExcel";var b=ECS.api.rttUrl+"/emergencyEquipment/ExportExcel";var e=ECS.api.rttUrl+"/emergencyEquipment/importAddAll";var d="../../bc/UploadFile/UploadFile.html?"+Math.random();ECS.util.importExcel(c,b,e,d)}}};a.init();window.page=a});
var searchTypeUrl=ECS.api.apUrl+"/event/getconfimPlanDefinition";var TypeUrl=ECS.api.rttUrl+"/emergencyEquipment/getBusinessInfo";var searchUrl=ECS.api.bcUrl+"/busiBgCateg/getTreeByModelID";var grid=null;var flag=false;var enterpriseCode="";var drtDeptCode="";window.pageLoadMode=PageLoadMode.None;$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI();b.logic.loadType();b.logic.initTable()},table:{},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnOK").click(function(){b.logic.select()});$("#btnQuery").click(function(){b.logic.search()})},data:{param:{}},logic:{getComboSelects:function(e,c,f,g,d){console.log(e);$.ajax({url:e,async:false,dataType:"json",success:function(i){console.log(i.length);var h=[];$.each(i,function(j,k){h.push({id:k[f],text:k[g]})});$("#"+c).select2({tags:d,data:h,language:{noResults:function(j){return"没有匹配项"}},});$("#teamId").attr("disabled","disabled")},})},loadType:function(c){b.logic.getComboSelects(TypeUrl,"teamId","businessId","businessName",false)},initTable:function(){b.logic.init()},onBeforeTreeLoad:function(f){var c=f.sender;var d=f.node;var g=f.params;g.myField="123"},select:function(){var d=mini.get("datagrid");var c=d.getSelected();parent.ownDetail=c;b.logic.closeLayer(true)},init:function(c){grid=mini.get("datagrid");$.ajax({url:searchUrl+"?businessModelId=32",type:"get",success:function(d){grid.loadList(d,"code","pCode")},error:function(d){}})},search:function(){var c=$("#key").val();if(c==""){mini.get("datagrid").clearFilter()}else{c=c.toLowerCase();mini.get("datagrid").filter(function(d){var e=d.categName?d.categName:"";if(e.indexOf(c)!=-1){return true}})}},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)},}};b.init();window.page=b});
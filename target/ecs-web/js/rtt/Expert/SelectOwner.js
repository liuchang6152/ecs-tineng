var professionNameUrl=ECS.api.rttUrl+"/expert/expertProfession";var industryNameUrl=ECS.api.rttUrl+"/expert/expertIndustry";var enjoyWorksUrl=ECS.api.rttUrl+"/expert/expertEnjoyWorks";var pageMode=PageModelEnum.Details;window.pageLoadMode=PageLoadMode.None;var initUserInfo={};$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI()},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){b.logic.save()});$(".btnClose").click(function(){var d={};if($("#grid2 p").length>0){for(var c=0;c<$("#grid2 p").length;c++){d[$("#grid2 p").eq(c).attr("id")]=$("#grid2 p").eq(c).attr("name")}}parent.ownDetail=d;window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("#add").click(function(){b.logic.moveAdd()});$("#remove").click(function(){b.logic.moveRemove()})},logic:{setData:function(c){$("#title-main").text(c.title);pageMode=c.pageMode;$("#grid2 p").click(function(){$(this).siblings("p").removeClass("selected");$(this).addClass("selected")});if(c.isList=="1"){b.logic.expertProfessionID(professionNameUrl+"?isAll=false","#tree1")}if(c.isList=="2"){b.logic.expertProfessionID(industryNameUrl+"?isAll=false","#tree1")}if(c.isList=="3"){b.logic.expertProfessionID(enjoyWorksUrl+"?isAll=false","#tree1")}},expertProfessionID:function(c,d){$.ajax({url:c,type:"get",beforeSend:function(){ECS.showLoading()},success:function(e){ECS.hideLoading();mini.get(d).loadList(e,"key","value")},error:function(e){ECS.hideLoading();var f=$.parseJSON(e.responseText);layer.msg(f.collection.error.message)}})},moveAdd:function(){var c=mini.get("tree1").getSelectedNode();var e=false;var f=$("#grid2 p");for(var d=0;d<$("#grid2 p").length;d++){if(c.userID==f[d].id){e=true}}if(!e){$("#grid2").append("<p name='"+c.value+"' id='"+c.key+"'>"+c.value+"</p>")}$("#grid2 p").click(function(){$(this).siblings("p").removeClass("selected");$(this).addClass("selected")})},moveRemove:function(){$(".selected").remove()},onDrawNode:function(f){console.log(f);var c=f.node;var d=f.node.key;if(d==null){f.iconCls="mini-tree-folder"}else{f.iconCls="mini-tree-user"}},beforenodeselect:function(d){console.log(d);var c=d.node.key;if(d.node.key==null){d.cancel=true}},search:function(){var c=mini.get("key").getValue();if(c==""){mini.get("tree1").clearFilter()}else{c=c.toLowerCase();mini.get("tree1").filter(function(d){var e=d.value?d.value:"";if(e.indexOf(c)!=-1){return true}})}},save:function(){var d={};if($("#grid2 p").length>0){for(var c=0;c<$("#grid2 p").length;c++){d[$("#grid2 p").eq(c).attr("id")]=$("#grid2 p").eq(c).attr("name")}}parent.ownDetail=d;b.logic.closeLayer(true)},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)}}};b.init();window.page=b});
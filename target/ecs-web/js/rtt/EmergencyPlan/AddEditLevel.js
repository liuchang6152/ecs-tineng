var addUrl=ECS.api.rttUrl+"/structuredplancategory";var getSingleUrl=ECS.api.rttUrl+"/structuredplancategory/findOne";var structuredPlanCategoryId=null;var structuredPlanCategoryPid=null;var ParentName=null;var emergencyPlanID=null;var emergencyPlanName=null;var pageMode=PageModelEnum.NewAdd;window.pageLoadMode=PageLoadMode.None;$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI()},table:{},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){b.logic.save()})},data:{param:{}},logic:{setData:function(c){$("#title-main").text(c.title);pageMode=c.pageMode;structuredPlanCategoryId=c.Id;structuredPlanCategoryPid=c.PID;emergencyPlanID=c.emergencyPlanID;ParentName=c.ParentName;emergencyPlanName=c.Name;$("#structuredPlanCategoryPidName").attr("disabled","disabled");if(pageMode==PageModelEnum.Edit){$.ajax({url:getSingleUrl+"?structuredPlanCategoryId="+structuredPlanCategoryId,async:false,type:"GET",data:JSON.stringify({}),dataType:"json",contentType:"application/json;charset=utf-8",success:function(d){ECS.form.setData("AddOrEditModal",d)},error:function(d){var e=$.parseJSON(d.responseText);layer.msg(e.collection.error.message)}})}if(pageMode==PageModelEnum.NewAdd){if(structuredPlanCategoryPid){$("#structuredPlanCategoryPidName").val(ParentName)}else{$("#structuredPlanCategoryPidName").val(ParentName?ParentName:"");if(emergencyPlanName){$("#emergencyPlanName").val(emergencyPlanName);$("#emergencyPlanName").attr("disabled","disabled")}}}},save:function(){b.logic.formValidate();if(!$("#AddOrEditModal").valid()){return}var c=ECS.form.getData("AddOrEditModal");var d="POST";if(pageMode==PageModelEnum.NewAdd){window.pageLoadMode=PageLoadMode.Reload}else{if(pageMode==PageModelEnum.Edit){d="PUT";window.pageLoadMode=PageLoadMode.Refresh}}c.structuredPlanCategoryId=structuredPlanCategoryId?structuredPlanCategoryId:null;c.emergencyPlanId=emergencyPlanID;c.structuredPlanCategoryPid=structuredPlanCategoryPid?structuredPlanCategoryPid:null;c.inUse=1;c.sortNum=$("#sortNum").val()?$("#sortNum").val():1;delete c.structuredPlanCategoryPidName;$.ajax({url:addUrl,async:false,type:d,data:JSON.stringify(c),dataType:"json",contentType:"application/json;charset=utf-8",beforeSend:function(){$("#btnSave").attr("disabled","disabled");ECS.showLoading()},success:function(e){ECS.hideLoading();if(e.isSuccess){layer.msg("保存成功！",{time:1000},function(){b.logic.closeLayer(true)})}else{layer.msg(e.message)}},error:function(e){$("#btnSave").attr("disabled",false);ECS.hideLoading();var f=$.parseJSON(e.responseText);layer.msg(f.collection.error.message)}})},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)},formValidate:function(){ECS.form.formValidate("AddOrEditModal",{rules:{emergencyPlanName:{required:true}}})}}};b.init();window.page=b});
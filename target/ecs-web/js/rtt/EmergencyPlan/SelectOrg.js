var getOrgIdUrl=ECS.api.bcUrl+"/org/getOrgIdByCode";var orgId=null;var grid=null;var dutyTypeUrl=ECS.api.bcUrl+"/duty/type";var dutyLevelUrl=ECS.api.bcUrl+"/duty/level";var searchUrl=ECS.api.rttUrl+"/emergencyduties/duty";window.ownDetail;var pageMode=PageModelEnum.NewAdd;window.pageLoadMode=PageLoadMode.None;$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI()},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnQuery").click(function(){b.logic.search()});$("#accidentCategoryID").on("change",function(){b.logic.category_menu2()});$("#btnSave").click(function(){b.logic.save()});$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)})},data:{param:{}},logic:{save:function(){var c=new Array();var e=new Array();var d=grid.getSelecteds();if(d.length==0){layer.msg("请选择对应职位的责任人！");return false}else{$.each(d,function(f,g){var h={};h.dutyID=g.dutyID;h.dutyName=g.dutyName+"("+(g.userNames?g.userNames:"")+")";c.push(h)});parent.aPositionList=[];parent.aPositionList=c;window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)}},setData:function(c){$("#title-main").text(c.title);pageMode=c.pageMode;b.logic.initDutyType();b.logic.initDutyLevel();ECS.sys.RefreshContextFromSYS();parent.aPositionList=[];b.logic.GetOrgId(function(){b.logic.initTable()})},initDutyType:function(){$.ajax({url:dutyTypeUrl,type:"GET",timeout:5000,success:function(d){var e='<option value="">全部</option>';$("#dutyTypeID").append(e);for(var c=0;c<d.length;c++){(function(g){var f='<option value="'+g.dutyTypeID+'">'+g.dutyTypeName+"</option>";$("#dutyTypeID").append(f)})(d[c])}}})},initDutyLevel:function(){$.ajax({url:dutyLevelUrl,type:"GET",timeout:5000,success:function(d){var e='<option value="">全部</option>';$("#dutyLevelID").append(e);for(var c=0;c<d.length;c++){(function(g){var f='<option value="'+g.dutyLevelID+'">'+g.dutyLevelName+"</option>";$("#dutyLevelID").append(f)})(d[c])}}})},initTable:function(){grid=mini.get("datagrid");grid.set({url:searchUrl,ajaxType:"get",dataField:"pageList"});b.logic.search(true)},GetOrgId:function(c){$.ajax({url:getOrgIdUrl+"?orgCode="+ECS.sys.Context.SYS_ENTERPRISE_CODE,type:"GET",timeout:5000,success:function(d){orgId=d.orgId;c&&c()}})},search:function(c){b.data.param={};b.data.param=ECS.form.getData("searchForm");if(c){b.data.param.sortType=1}b.data.param.orgID=orgId;grid.load(b.data.param)},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)}}};b.init();window.page=b});
var orgUrl=ECS.api.apUrl+"/event/getSecunit";var dutyUrl=ECS.api.rttUrl+"/team/getTeamDuty?orgId=";var joinUrl=ECS.api.rttUrl+"/team/getTeamJoint?orgId=";$(function(){var a={init:function(){mini.parse();this.bindUI();a.logic.initPage()},table:{},bindUI:function(){$("#bindDuty").click(function(){a.logic.bindDuty()});$("#bindJoin").click(function(){a.logic.bindJoin()});mini.get("org").on("nodeclick",function(c){var b=c.row[this.idField];a.logic.loadDuty(b);a.logic.loadJoin(b)})},data:{param:{}},logic:{initPage:function(){a.logic.loadOrg()},loadOrg:function(){$.ajax({url:orgUrl,type:"GET",success:function(b){mini.get("org").loadData(b)},error:function(b){console.log(b)}})},loadDuty:function(b){ECS.showLoading();$.ajax({url:dutyUrl+b,type:"GET",success:function(c){mini.get("dutyTeam").loadData(c);ECS.hideLoading()},error:function(c){console.log(c)}})},loadJoin:function(b){ECS.showLoading();$.ajax({url:joinUrl+b,type:"GET",success:function(c){mini.get("joinTeam").loadData(c);ECS.hideLoading()},error:function(c){console.log(c)}})},bindDuty:function(){var b=mini.get("org").getSelectedNode();if(b==null||b==undefined){layer.msg("请选择需要绑定的二级机构");return}ECS.util.detail({url:"team.html",data:{title:"绑定责任队",orgId:b.drtDeptId,dutyGrade:0,bindTeamIds:a.logic.getbindTeamIds("dutyTeam")}})},bindJoin:function(){var b=mini.get("org").getSelectedNode();if(b==null||b==undefined){layer.msg("请选择需要绑定的二级机构");return}ECS.util.detail({url:"team.html",data:{title:"绑定联防队",orgId:b.drtDeptId,dutyGrade:1,bindTeamIds:a.logic.getbindTeamIds("joinTeam")}})},getbindTeamIds:function(c){var e="";var f=mini.get(c).getData();for(var d=0,b=f.length;d<b;d++){e+=f[d].teamID+","}e=e.substring(0,e.length-1);return e}}};a.init();window.page=a});
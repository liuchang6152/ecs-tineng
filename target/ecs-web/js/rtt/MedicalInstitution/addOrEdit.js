var madicalUrl=ECS.api.rttUrl+"/medicalInstitutio";var madicalTypeUrl=ECS.api.rttUrl+"/medicalInstitutio/getAllMediInstitutionType";var madicalLvUrl=ECS.api.rttUrl+"/medicalInstitutio/getAllLvl";$(function(){var a={init:function(){mini.parse();this.logic.initPage();this.bindUI()},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){a.logic.save()});$(".btnClose").click(function(){a.logic.closeLayer(false)})},data:{param:{}},logic:{initPage:function(){ECS.util.bindCmb({ctrId:"typeID",url:madicalTypeUrl,idField:"typeID",textField:"typeName"});ECS.util.bindCmb({ctrId:"institutionLvl",url:madicalLvUrl,idField:"institutionLvl",textField:"name"})},setData:function(b){$("#title-main").text(b.title);a.data.param.pageMode=b.pageMode;a.data.param.id=b.id;if(b.pageMode!=PageModelEnum.NewAdd){$.ajax({url:madicalUrl+"/"+b.id,type:"get",dataType:"json",beforeSend:function(){ECS.showLoading()},success:function(d){if(d.isSuccess){var c=new mini.Form("AddOrEditModal");c.setData(d.result);$("#serviceSpecial").val(d.result.serviceSpecial);$("#remarks").val(d.result.remarks)}else{layer.msg(d.message)}ECS.hideLoading()},error:function(c){ECS.hideLoading();var d=$.parseJSON(c.responseText);layer.msg(d.collection.error.message)}})}},save:function(){a.logic.formValidate();if(!$("#AddOrEditModal").valid()){return}var b=ECS.form.getData("AddOrEditModal");ECS.util.addOrEdit({url:madicalUrl,data:b,pageMode:a.data.param.pageMode},function(c){var c=$.parseJSON(c);if(c.isSuccess){layer.msg("操作成功",{time:1000},function(){parent.page.logic.search();a.logic.closeLayer(true)})}else{layer.msg(c.message)}},function(c){var d=$.parseJSON(c.responseText);layer.msg(d.message)})},closeLayer:function(c){var b=parent.layer.getFrameIndex(window.name);parent.layer.close(b)},formValidate:function(){ECS.form.formValidate("AddOrEditModal",{ignore:"",rules:{institutionName:{required:true},institutionLvl:{required:true},typeID:{required:true},contactPhone:{number:true},galleryful:{required:true,number:true}}})}}};a.init();window.page=a});
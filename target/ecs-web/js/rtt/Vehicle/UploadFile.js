var importUrl=ECS.api.rttUrl+"/vehicle/importExcelDate";var pageMode=PageModelEnum.Details;window.pageLoadMode=PageLoadMode.None;var mini;var uploader;$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI();ECS.sys.RefreshContextFromSYS();b.logic.upload()},table:{},data:{param:{}},bindUI:function(){$("#btnSave").click(function(){if(uploader.files.length>0){uploader.start()}});$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)})},logic:{setData:function(c){},start:function(){},upload:function(){uploader=new plupload.Uploader({browse_button:"upload_btn",drop_element:"upload_box",url:importUrl,multipart_params:{},filters:{mime_types:[{title:"EXcel",extensions:"xls,xlsx"}],max_file_size:"40000kb",prevent_duplicates:true}});uploader.init();uploader.bind("FilesAdded",function(d,c){if(c[0].name.length>50){d.removeFile(c[0]);layer.msg("文件名称不能超过50个字符！");return}if(c[0].size>10485760){d.removeFile(c[0]);layer.msg("文件大小不能超过10MB！");return}$("#fileName").text("文件名："+c[0].name)});uploader.bind("UploadProgress",function(e,c){var d=c.percent;ECS.util.show_percent(d);if(d==100){ECS.util.hide_percent()}});uploader.bind("FileUploaded",function(f,e,d){var c=JSON.parse(d.response);ECS.util.hide_percent();if(c.isSuccess){layer.msg("保存成功！",{time:1000},function(){b.logic.closeLayer(true)})}else{layer.msg(c.message)}})},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)}}};b.init();window.page=b});
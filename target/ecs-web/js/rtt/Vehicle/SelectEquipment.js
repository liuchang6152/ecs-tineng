var searchTypeUrl=ECS.api.apUrl+"/event/getconfimPlanDefinition";var smallTypeUrl=ECS.api.apUrl+"/event/getAccidentCategory";var searchUrl=ECS.api.rttUrl+"/emergencyEquipment";var exportUrl=ECS.api.rttUrl+"/emergencyEquipment/ExportToExcel";var dept_url=ECS.api.apUrl+"/event/getSecunit";var riskType_url=ECS.api.apUrl+"/event/getRiskArea";var OptRisk_url=ECS.api.apUrl+"/event/getOptRisk";var RiskAnlsObj_url=ECS.api.apUrl+"/event/getRiskAnlsObj";var delUrl=ECS.api.rttUrl+"/emergencyEquipment";var Enterprise_url=ECS.api.rttUrl+"/expert/getExpertTypeEnumList";var inUseUrl=ECS.api.commonUrl+"/getInUse";var bigUrl=ECS.api.bcUrl+"/busiBgCateg/getListByModelID?businessModelId=32";var mUrl=ECS.api.bcUrl+"/busiBgCateg/getListByBgCode";var stockpilePointTypeUrl=ECS.api.rttUrl+"/mtrlStorage/getStoreTypeEnumList";var stockpileTypeUrl=ECS.api.rttUrl+"/mtrlStorage/getRepoTypeEnumList";var grid=null;var flag=false;var enterpriseCode="";var drtDeptCode="";window.pageLoadMode=PageLoadMode.None;$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI();b.logic.loadType();$("#searchForm")[0].reset();b.logic.initTable()},table:{},bindUI:function(){$("#btnToggle").click(function(){if(flag){flag=!flag;$(this).html('<i class="icon-showMore"></i>');$(".search-unfixed").hide()}else{flag=!flag;$(this).html('<i class="icon-hideMore"></i>');$(".search-unfixed").show()}});$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("#btnSave").click(function(){b.logic.save()});$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnQuery").click(function(){b.logic.search()});$("#businessBgCategID").change(function(c){b.logic.loadmodelType($("#businessBgCategID").val())})},data:{param:{}},logic:{setUrlK:function(g){var e="",c,d;for(var f in g){if(g.hasOwnProperty(f)){c=f}d=g[f];e+="&"+c+"="+encodeURIComponent(d)}return e.substring(1,e.length)},getEnterpriseType:function(){$("#equIpOwner").html('<option value="" selected="selected">可输入</option>');var c=[{text:"队伍",id:1},{text:"企业",id:2}];$("#equIpOwner").select2({tags:false,data:c,language:{noResults:function(d){return"没有匹配项"}},})},loadType:function(c){b.logic.getEnterpriseType();ECS.ui.getComboSelects(searchTypeUrl,"planDefinition","id","name",false);ECS.ui.getComboSelects(smallTypeUrl,"smallIds","accidentTypeID","accidentTypeName",false);ECS.ui.getComboSelects(dept_url,"enterpriseCode","drtDeptCode","drtDeptName",false);ECS.ui.getComboSelects(bigUrl,"businessBgCategID","businessBgCategCode","businessBgCategName",false);ECS.ui.getComboSelects(stockpilePointTypeUrl,"stockpilePointType","key","value",false);ECS.ui.getComboSelects(stockpileTypeUrl,"stockpileType","key","value",false);ECS.ui.getComboSelects("","businessMdCategID","businessMdCategCode","businessMdCategName",false);ECS.ui.getCombobox("inUse",inUseUrl,{selectValue:"-1",data:{isAll:true}},null)},loadmodelType:function(c){ECS.ui.getComboSelects(mUrl+"?businessBgCategCode="+c,"businessMdCategID","businessMdCategCode","businessMdCategName",false)},initTable:function(){b.logic.search()},search:function(c){b.data.param=ECS.form.getData("searchForm");grid=mini.get("datagrid");grid.set({url:searchUrl,ajaxType:"get",dataField:"pageList"});grid.load(b.data.param)},save:function(){var c=mini.get("datagrid").getSelecteds();parent.ownDetail=c;b.logic.closeLayer(true)},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)},}};b.init();window.page=b});
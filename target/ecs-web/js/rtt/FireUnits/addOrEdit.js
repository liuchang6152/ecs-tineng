var fireUnitsUrl=ECS.api.rttUrl+"/relatedFireUnits";$(function(){var a={init:function(){mini.parse();ECS.sys.RefreshContextFromSYS();this.bindUI()},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){a.logic.save()});$(".btnClose").click(function(){a.logic.closeLayer(false)})},data:{param:{}},logic:{setData:function(c){$("#title-main").text(c.title);a.data.param.pageMode=c.pageMode;a.data.param.id=c.id;if(c.pageMode!=PageModelEnum.NewAdd){mini.get("mntUserDept").setValue(ECS.sys.Context.SYS_ORG_UNIT_NAME);mini.get("mntUserName").setValue(ECS.sys.Context.SYS_USER_NAME);mini.get("mntDateStr").setValue(mini.formatDate(new Date(),"yyyyMMdd"));var b=new mini.Form("AddOrEditModal");$.ajax({url:fireUnitsUrl+"/"+c.id,type:"get",dataType:"json",beforeSend:function(){ECS.showLoading()},success:function(d){if(d.isSuccess){b.setData(d.result)}else{layer.msg(d.message)}ECS.hideLoading()},error:function(d){ECS.hideLoading();var e=$.parseJSON(d.responseText);layer.msg(e.collection.error.message)}})}else{mini.get("crtUserDept").setValue(ECS.sys.Context.SYS_ORG_UNIT_NAME);mini.get("crtUserName").setValue(ECS.sys.Context.SYS_USER_NAME);mini.get("crtDateStr").setValue(mini.formatDate(new Date(),"yyyyMMdd"));mini.get("mntUserDept").setValue(ECS.sys.Context.SYS_ORG_UNIT_NAME);mini.get("mntUserName").setValue(ECS.sys.Context.SYS_USER_NAME);mini.get("mntDateStr").setValue(mini.formatDate(new Date(),"yyyyMMdd"))}},save:function(){a.logic.formValidate();if(!$("#AddOrEditModal").valid()){return}var b=ECS.form.getData("AddOrEditModal");ECS.util.addOrEdit({url:fireUnitsUrl,data:b,pageMode:a.data.param.pageMode},function(c){var c=$.parseJSON(c);if(c.isSuccess){layer.msg("操作成功",{time:1000},function(){parent.page.logic.search();a.logic.closeLayer(true)})}else{layer.msg(c.message)}})},closeLayer:function(c){var b=parent.layer.getFrameIndex(window.name);parent.layer.close(b)},formValidate:function(){ECS.form.formValidate("AddOrEditModal",{ignore:"",rules:{name:{required:true},tel:{required:true}}})}}};a.init();window.page=a});
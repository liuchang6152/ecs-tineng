var fireUnitsUrl=ECS.api.rttUrl+"/relatedFireUnits";var exportUrl=ECS.api.rttUrl+"/relatedFireUnits/ExportToExcel";pageflag=true;redisKey="";var inUseUrl=ECS.api.commonUrl+"/getInUse";$(function(){var a={init:function(){mini.parse();a.logic.initPage();a.logic.search();this.bindUI()},table:{},bindUI:function(){$("input").blur(function(){var b=$.trim($(this).val());$(this).val(b);mini.get(this.name).setValue(b)});$("#btnAdd").click(function(){a.logic.add()});$("#btnDel").click(function(){a.logic.del()});$("#btnQuery").click(function(){a.logic.search()});$("#btnImp").click(function(){a.logic.imp()});$("#btnExport").click(function(){var c=new mini.Form("searchForm");var d=c.getData();var b=a.logic.setUrlK(a.data.param);window.open(exportUrl+"?"+b)})},data:{param:{}},logic:{setUrlK:function(f){var d="",b,c;for(var e in f){if(f.hasOwnProperty(e)){b=e}c=f[e];d+="&"+b+"="+encodeURIComponent(c)}return d.substring(1,d.length)},initPage:function(){ECS.util.bindCmb({ctrId:"inUse",url:inUseUrl,data:{isAll:true},idField:"key",textField:"value"},function(){mini.get("inUse").select(0)})},search:function(){var b=mini.get("datagrid");b.set({url:fireUnitsUrl,ajaxType:"get",dataField:"pageList"});var c=new mini.Form("searchForm");var d=c.getData();b.load(d)},reset:function(){var b=new mini.Form("searchForm");b.reset()},add:function(){ECS.util.detail({url:"addOrEdit.html",height:500,data:{title:"新增相关消防单位",pageMode:PageModelEnum.NewAdd}})},edit:function(b){var c=mini.get("datagrid").getRowByUid(b);ECS.util.detail({url:"addOrEdit.html",height:500,data:{title:"编辑相关消防单位",pageMode:PageModelEnum.Edit,id:c.relatedFireUnitsId}})},del:function(){ECS.util.del({url:fireUnitsUrl,grid:mini.get("datagrid"),idField:"relatedFireUnitsId",delArrKey:"relatedFireUnitsIds"},function(b){b=$.parseJSON(b);if(b.isSuccess){layer.msg("操作成功",{time:1000},function(){a.logic.search();a.logic.closeLayer(true)})}else{layer.msg(b.message)}})},rendererInUse:function(b){return ECS.util.renderer(b,[{key:0,value:"否"},{key:1,value:"是"}])},imp:function(){var c=ECS.api.rttUrl+"/relatedFireUnits/importExcel";var b=ECS.api.rttUrl+"/relatedFireUnits/ExportExcel";var e=ECS.api.rttUrl+"/relatedFireUnits/importAddAll";var d="../../bc/UploadFile/UploadFile.html?"+Math.random();ECS.util.importExcel(c,b,e,d)}}};a.init();window.page=a});
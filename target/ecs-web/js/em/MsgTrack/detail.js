$(function(){var a=parent.layer.getFrameIndex(window.name);var b={searchUrl:ECS.api.emUrl+"/msg/msgfeedback",init:function(){mini.parse();this.bindUI();b.logic.initTable()},bindUI:function(){$(".btnClose").click(function(){b.logic.closeLayer(false)});$("#btnQuery").click(function(){b.logic.search()})},data:{param:{}},logic:{initTable:function(){grid=mini.get("datagrid");grid.set({url:b.searchUrl,ajaxType:"get",dataField:"pageList"})},search:function(){var d=mini.formatDate(mini.get("startTime").getValue(),"yyyy-MM-dd HH:mm:ss");var c=mini.formatDate(mini.get("endTime").getValue(),"yyyy-MM-dd HH:mm:ss");if(d>c){layer.msg("开始时间不能大于结束时间");return}$.extend(b.data.param,{sendType:$("#sendType").val(),receiverName:$.trim($("#receiverName").val()),feedBackContent:$.trim($("#feedBackContent").val()),startTime:d,endTime:c});grid.load(b.data.param)},show_sendType:function(c){if(c.value==1){return"短信"}else{if(c.value==2){return"群呼"}else{if(c.value==3){return"短信、群呼"}}}},show_receiverCode:function(c){return'<a href="javascript:page.logic.callReceiver('+c.value+')">'+c.value+"</a>"},callReceiver:function(c){parent.parent.call(c,function(){layer.open({type:1,offset:"auto",id:"layerDemoauto",area:["420px","240px"],content:'<div style="text-align:center;padding-top:60px;">正在呼叫电话'+c+"</div>",btn:"取消",btnAlign:"c",shade:0,closeBtn:0,yes:function(){parent.parent.hangup();layer.closeAll()},title:"拨打电话"})})},setData:function(c){$("#title-main").text(c.title);$("#msgContent").val(c.msgContent);b.data.param.msgID=c.msgID;b.data.param.feedbackStatus=c.feedbackStatus;if(c.businessModelId){b.data.param.businessModelId=c.businessModelId;b.data.param.systemId=c.systemId}this.search()},closeLayer:function(c){parent.layer.close(a)}}};b.init();window.page=b});
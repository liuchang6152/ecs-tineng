var addUrl=ECS.api.emUrl+"/CommGroups";var delUrl=ECS.api.emUrl+"/CommGroups";window.pageLoadMode=PageLoadMode.None;var enterpriseCode="";var enterpriseName="";var commGroupTypeCode="";var commGroupTypeName="";var groupName="";var groupId="";$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI()},table:{},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){b.logic.save()})},data:{param:{}},logic:{setData:function(c){enterpriseCode=c.enterpriseCode;enterpriseName=c.enterpriseName;commGroupTypeName=c.commGroupTypeName;commGroupTypeCode=c.commGroupTypeId;groupName=c.groupName;groupId=c.groupId;$("#orgName").val(enterpriseName);$("#commGroupType").val(c.commGroupTypeName);$("#title-main").text(c.title);$("#commGroupName").val(groupName);pageMode=c.pageMode;if(pageMode==PageModelEnum.NewAdd){return}},save:function(){b.logic.formValidate();if(!$("#AddOrEditModal").valid()){return}var d=ECS.form.getData("AddOrEditModal");var c={commGroupTypeId:commGroupTypeCode,groupName:d.commGroupName,enterpriseCode:enterpriseCode,commGroupid:groupId};var e="POST";if(pageMode==PageModelEnum.NewAdd){window.pageLoadMode=PageLoadMode.Reload}else{if(pageMode==PageModelEnum.Edit){e="PUT";window.pageLoadMode=PageLoadMode.Refresh}}console.log(JSON.stringify(c));$.ajax({url:addUrl,async:false,type:e,data:JSON.stringify(c),dataType:"json",contentType:"application/json;charset=utf-8",beforeSend:function(){$("#btnSave").attr("disabled","disabled");ECS.showLoading()},success:function(f){ECS.hideLoading();if(f.isSuccess){layer.msg("保存成功！",{time:1000},function(){b.logic.closeLayer(true)})}else{layer.msg(f.message)}},error:function(f){$("#btnSave").attr("disabled",false);ECS.hideLoading();var g=$.parseJSON(f.responseText);layer.msg(g.collection.error.message)}})},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)},formValidate:function(){ECS.form.formValidate("AddOrEditModal",{rules:{commGroupName:{required:true}}})}}};b.init();window.page=b});
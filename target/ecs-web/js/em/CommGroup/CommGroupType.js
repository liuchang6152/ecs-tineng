var delUrl=ECS.api.emUrl+"/CommGroupsType";var searchUrl=ECS.api.emUrl+"/CommGroupsType";var enterpriseCodeUrl=ECS.api.bcUrl+"/org/porgName?orgLvl=2&isAll=true";window.pageLoadMode=PageLoadMode.None;var enterpriseCode="";$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI();b.logic.initTable();b.logic.initOrgCode(enterpriseCodeUrl)},table:{},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnAdd").click(function(){b.logic.add("新增","",PageModelEnum.NewAdd)});$("#btnQuery").click(function(){b.logic.search()});$("#btnDel").click(function(){b.logic.delAll()})},data:{param:{}},logic:{setData:function(c){enterpriseCode=c.enterpriseCode;$("#title-main").text(c.title);mini.get("enterpriseCode").setValue(enterpriseCode);mini.get("enterpriseCode").setEnabled(false);b.logic.search();pageMode=c.pageMode;if(pageMode==PageModelEnum.NewAdd){return}},initTable:function(){mini.parse();grid=mini.get("datagrid")},show_edit:function(c){return ECS.util.editRender(c.row.commGroupTypeId,c.row.enterpriseCode)},initOrgCode:function(c){$.ajax({url:c,type:"get",success:function(d){mini.get("enterpriseCode").loadList(d,"orgCode","porgCode");mini.get("enterpriseCode").setValue(enterpriseCode)}})},search:function(d){b.data.param=ECS.form.getData("searchForm");if(d){b.data.param.sortType=1}var c=searchUrl+"/query";grid.set({url:c,ajaxType:"get",dataField:"pageList"});grid.load({enterpriseCode:mini.get("enterpriseCode").value,commGroupTypeName:mini.get("TypeName").value})},delAll:function(){var c=[];var d=grid.getSelecteds();$.each(d,function(e,f){c.push({commGroupTypeId:f.commGroupTypeId})});if(c.length==0){layer.msg("请选择要删除的数据!");return}layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){$.ajax({url:delUrl,async:true,data:JSON.stringify(c),dataType:"json",timeout:1000,contentType:"application/json;charset=utf-8",type:"DELETE",success:function(e){if(e.isSuccess){layer.msg("删除成功！",{time:1000},function(){grid.reload()})}else{layer.msg(e.message)}},error:function(e){var f=$.parseJSON(e.responseText);layer.msg(f.collection.error.message)}})},function(e){layer.close(e)})},add:function(){var c=PageModelEnum.NewAdd;var d="通讯组类型配置";b.logic.detail(d,"","",c)},edit:function(e,c){var d=PageModelEnum.Edit;var f="通讯组类型配置";b.logic.detail(f,e,c,d)},detail:function(i,f,c,e){var h;if(e==PageModelEnum.Edit){var g=mini.get("datagrid").getSelected();h=g.commGroupTypeName}var d=grid.getList();var g=grid.getSelected();layer.open({type:2,closeBtn:0,area:["400px","80%"],skin:"new-class",shadeClose:false,title:false,content:"CommGroupTypeAddOrEdit.html?"+Math.random(),success:function(k,l){var j=layer.getChildFrame("body",l);var n=window[k.find("iframe")[0]["name"]];var m={pageMode:e,commGroupTypeId:f,commGroupTypeName:h,orgID:c,title:i,enterpriseCode:enterpriseCode};if(e==PageModelEnum.Edit){m.gridList=d;m.row=g}n.page.logic.setData(m)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){b.logic.search(true);window.pageLoadMode=PageLoadMode.None}else{if(window.pageLoadMode==PageLoadMode.Reload){b.logic.search(true);window.pageLoadMode=PageLoadMode.None}}}})},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)}}};b.init();window.page=b});
var delUrl=ECS.api.emUrl+"/DispatchDeviceConfig";var searchUrl=ECS.api.emUrl+"/DispatchDeviceConfig";var enterpriseUrl=ECS.api.bcUrl+"/org/porgName?orgLvl=2";var riskArea_url=ECS.api.emUrl+"/DispatchDeviceConfig/getTreeList";window.pageLoadMode=PageLoadMode.None;var orgId="";var flag=false;var addObj;$(function(){var a={init:function(){mini.parse();this.bindUI();ECS.sys.RefreshContextFromSYS();$("#searchForm").find("input").val("");a.logic.cbxEnterprise();a.logic.initTable("","")},table:{},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){a.logic.removeAll(grid2)});$("#msg").change(function(){var b=$("#autoMsg").val()+"　";if(this.value!=0){b+=$("#msg").find("option:selected").text()+"　"}$(this).find("option:first").attr("selected","selected");$("#autoMsg").val(b)});$("#nums").change(function(){if(this.value==0){$("#custom").show()}else{$("#custom").hide()}});$("#autoNum").bind("change",function(){if($("#autoNum").val()<11){layer.msg("请输入大于10的正整数");$("#autoNum").val("11")}});mini.get("tree1").on("nodeselect",function(b){$("#searchForm")[0].reset();addObj={baseModelCategory:b.node.obj,baseDataId:b.node.tid,enterpriseID:orgId,deviceMode:"1"};flag=true;grid.load({baseModelCategory:b.node.obj,baseDataId:b.node.tid,enterpriseID:orgId,deviceMode:"1"})})},data:{param:{}},logic:{initTable:function(c,b){grid1=mini.get("noSelect");grid2=mini.get("haveSelect");grid3=mini.get("turnSelect");$.ajax({url:searchUrl+"?orgId="+c+"&riskAreaID="+b+"&pageIndex=0&pageSize=10&sortField=&sortOrder=",type:"GET",beforeSend:function(){ECS.showLoading()},success:function(f){ECS.hideLoading();var e=f.pageList.filter(function(g){return g.deviceE.deviceCatgName==="消息类"});var d=f.pageList.filter(function(g){return g.deviceE.deviceCatgName==="开关类"});grid1.setData(e);grid3.setData(d)}})},cbxEnterprise:function(){if(ECS.sys.isHQ(ECS.sys.Context.SYS_ENTERPRISE_CODE)){ECS.ui.getCombobox("enterpriseCode",enterpriseUrl,{selectFirstRecord:true,keyField:"orgCode",valueField:"orgSname",codeField:"orgId",async:false},null,a.logic.load_sidebar)}else{ECS.ui.getCombobox("enterpriseCode",enterpriseUrl,{selectValue:ECS.sys.Context.SYS_ENTERPRISE_CODE,keyField:"orgCode",valueField:"orgSname",codeField:"orgId",async:false},null,a.logic.load_sidebar);$("#enterpriseCode").attr("disabled",true)}a.logic.load_sidebar()},load_sidebar:function(){orgId=$("#enterpriseCode").find("option:selected").attr("code");var b=$("#enterpriseCode").val();if(b){$.ajax({url:riskArea_url+"?orgCode="+b+"&treeID="+orgId,type:"GET",beforeSend:function(){ECS.showLoading()},success:function(c){mini.get("tree1").loadList(c,"id","pid");ECS.hideLoading()}})}},curStatus:function(b){return'<a title="选择" href="javascript:window.page.logic.select()">选择</a>'},}};a.init();window.page=a});
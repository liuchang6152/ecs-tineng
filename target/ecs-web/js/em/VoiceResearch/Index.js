var searchUrl=ECS.api.emUrl+"/VoiceResearch";var exportUrl=ECS.api.emUrl+"/VoiceResearch/ExportToExcel";window.pageLoadMode=PageLoadMode.None;var enterpriseCode="";$(function(){var a={init:function(){mini.parse();this.bindUI();a.logic.initTable();a.logic.search(0)},table:{},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnExport").click(function(){a.data.param=ECS.form.getData("searchForm");window.open(exportUrl)});$("#btnQuery").click(function(){a.logic.search(0)});$("#btnDel").click(function(){a.logic.delAll()})},data:{param:{}},logic:{initTable:function(){grid=mini.get("datagrid");pager=mini.get("datagridPager");pager.on("pagechanged",function(b){a.logic.search(b.pageIndex)})},show_edit:function(b){return'<a href="javascript:window.page.logic.Player('+b.row._uid+')">'+b.value+"</a>"},search:function(c){var f=new mini.Form("searchForm");var g=f.getData();if(g.startTime>g.endTime){layer.msg("开始时间不能大于结束时间");return}if(c==undefined||c==null){c=0}a.data.param=ECS.form.getData("searchForm");var b=mini.formatDate(mini.parseDate(a.data.param.startTime),"yyyyMMddTHHmmssZ");var e=mini.formatDate(mini.parseDate(a.data.param.endTime),"yyyyMMddTHHmmssZ");var d=parent.getRecords(b,e,a.data.param.ringUpNumber,a.data.param.answerPhoneNumber,c,10);grid.setData(d.data);pager.setPageIndex(c);pager.setTotalCount(d.total)},delAll:function(){var b=[];var c=grid.getSelecteds();$.each(c,function(d,e){b.push({schedulId:e.schedulId})});if(b.length==0){layer.msg("请选择要删除的数据!");return}layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){$.ajax({url:delUrl,async:true,data:JSON.stringify(b),dataType:"json",timeout:1000,contentType:"application/json;charset=utf-8",type:"DELETE",success:function(d){if(d.isSuccess){layer.msg("删除成功！",{time:1000},function(){grid.reload()})}else{layer.msg(d.message)}},error:function(d){var e=$.parseJSON(d.responseText);layer.msg(e.collection.error.message)}})},function(d){layer.close(d)})},add:function(){var b=PageModelEnum.NewAdd;var c="通讯组新增";a.logic.detail(c,"","",b)},edit:function(d,b){var c=PageModelEnum.Edit;var e="编辑值班人员";a.logic.detail(e,d,b,c)},detail:function(h,e,b,d){var g;if(d==PageModelEnum.Edit){var f=mini.get("datagrid").getSelected();g=f.commGroupTypeName}var c=grid.getSelected();layer.open({type:2,closeBtn:0,area:["80%","70%"],skin:"new-class",shadeClose:false,title:false,content:"Edit.html?"+Math.random(),success:function(j,k){var i=layer.getChildFrame("body",k);var m=window[j.find("iframe")[0]["name"]];var l={pageMode:d,title:h};if(d==PageModelEnum.Edit){}m.page.logic.setData(l,c)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){a.logic.search(true);window.pageLoadMode=PageLoadMode.None}else{if(window.pageLoadMode==PageLoadMode.Reload){a.logic.search(true);window.pageLoadMode=PageLoadMode.None}}}})},Player:function(b){var c=grid.getRowByUid(b);parent.recordDownload(c.starttime,c.endtime,c.filename,c.vruid,c.streamid)},calltime:function(f){var b=f.record.starttime.substring(0,4)+"-"+f.record.starttime.substring(4,6)+"-"+f.record.starttime.substring(6,8)+" "+f.record.starttime.substring(9,11)+":"+f.record.starttime.substring(11,13)+":"+f.record.starttime.substring(13,15);var d=f.record.endtime.substring(0,4)+"-"+f.record.endtime.substring(4,6)+"-"+f.record.endtime.substring(6,8)+" "+f.record.endtime.substring(9,11)+":"+f.record.endtime.substring(11,13)+":"+f.record.endtime.substring(13,15);var c=mini.parseDate(d)-mini.parseDate(b);return c/1000},renderTime:function(b){return b.value.substring(0,4)+"-"+b.value.substring(4,6)+"-"+b.value.substring(6,8)+" "+b.value.substring(9,11)+":"+b.value.substring(11,13)+":"+b.value.substring(13,15)}}};a.init();window.page=a});
var initUrl=ECS.api.emUrl+"/meetingUser/getMeeting";var getAlertInformationUrl=ECS.api.apUrl+"/fileAlarmChild/getAlertInformation";var updateStatusUrl=ECS.api.emUrl+"/initiateMeeting/call";window.pageLoadMode=PageLoadMode.None;var vm=new Vue({el:"#main",data:{total:20,items:[],meetingAbstract:"",meetingTheme:"",startTime:"",meetingRecordId:"",crtUserName:"",usersCount:0,eventId:"",AlertInfo:"",show:true,heigth:""},mounted:function(){this.heigth=document.body.clientHeight-120+"px"},methods:{isShow:function(a){if(a&&a.length>0){return true}return false},getPhone:function(a){console.log(JSON.stringify(a));return a.isHandSet==0?a.phone:a.mobile}}});$(function(){var a={init:function(){mini.parse();a.bindUI();context.init({preventDoubleContext:false});context.attach("html",[{header:"操作"},{text:"呼叫",action:function(d){var c=$(".selectorDiv li input:checked + label");var b=[];$(c).each(function(f){var e=$(c[f]).attr("data");b.push(e)});parent.parent.makecall(b)}},{text:"屏蔽",action:function(d){var c=$(".selectorDiv li input:checked + label");var b=[];$(c).each(function(f){var e=$(c[f]).attr("data");b.push(e)});parent.meetCtrl(b,1);$(c).addClass("off");$(c).removeClass("on")}},{text:"取消屏蔽",action:function(d){var c=$(".selectorDiv li input:checked + label");var b=[];$(c).each(function(f){var e=$(c[f]).attr("data");b.push(e)});parent.meetCtrl(b,0);$(c).addClass("on");$(c).removeClass("off")}}]);$(document).on("mouseover",".me-codesta",function(){$(".finale h1:first").css({opacity:0});$(".finale h1:last").css({opacity:1})});$(document).on("mouseout",".me-codesta",function(){$(".finale h1:last").css({opacity:0});$(".finale h1:first").css({opacity:1})})},table:{},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSelect").click(function(){a.logic.Select()});$("#btnOffMeeting").click(function(){a.logic.OffMeeting()});$("#btnOff").click(function(){a.logic.Off()});$("#btnOn").click(function(){a.logic.On()});$("#btnLoad").click(function(){a.logic.init()})},data:{param:{}},logic:{setStatus:function(b,c){if(b.length==14&&b.substr(0,3)=="080"){b=b.substr(3,11)}if(c==3||c==4){$.ajax({url:updateStatusUrl+"?metingRecordId="+vm.meetingRecordId+"&phone="+b+"&status="+Number(c-2),async:false,type:"get",data:{},dataType:"json",contentType:"application/json;charset=utf-8",success:function(d){a.logic.init()},error:function(d){layer.msg("系统繁忙")}})}},setData:function(b){vm.meetingRecordId=b.meetingRecordPojo.meetingRecordId;vm.eventId=b.meetingRecordPojo.eventId;if(!vm.eventId){vm.show=false}a.logic.init()},init:function(){var b={meetingRecordId:vm.meetingRecordId};$.ajax({url:initUrl,async:true,data:b,dataType:"json",contentType:"application/json;charset=utf-8",type:"get",success:function(c){if(c.isSuccess){vm.items=c.result.users;vm.total=20-vm.items.length;vm.meetingAbstract=c.result.meetingAbstract;vm.meetingTheme=c.result.meetingTheme;vm.startTime=c.result.startTime;vm.crtUserName=c.result.crtUserName;vm.usersCount=c.result.usersCount}},error:function(c){var d=$.parseJSON(c.responseText);console.log(JSON.stringify(d));layer.msg("系统繁忙")}});if(vm.eventId){var b={eventId:vm.eventId};$.ajax({url:getAlertInformationUrl,async:true,data:b,dataType:"json",contentType:"application/json;charset=utf-8",type:"get",success:function(c){vm.AlertInfo=a.logic.Convert(c)},error:function(c){}})}},Convert:function(b){b.initTime=moment(b.initTime).format("YYYY-MM-DD HH:mm:ss");return b},Select:function(){layer.open({type:2,closeBtn:0,area:["80%","90%"],skin:"new-class",shadeClose:false,title:false,content:"Select.html?"+Math.random(),success:function(c,d){var b=layer.getChildFrame("body",d);var f=window[c.find("iframe")[0]["name"]];var e={title:"会议详情"};f.page.logic.setData(vm.meetingRecordId,vm.items)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){window.pageLoadMode=PageLoadMode.None}else{if(window.pageLoadMode==PageLoadMode.Reload){a.logic.init();window.pageLoadMode=PageLoadMode.None}}}})},OffMeeting:function(){var b=parent.layer.getFrameIndex(window.name);parent.layer.close(b)},Off:function(){var c=a.logic.getPhoneNum();parent.meetCtrl(c,1);var b=$(".selectorDiv li.init input + label");$(b).addClass("off");$(b).removeClass("on")},On:function(){var c=a.logic.getPhoneNum();parent.meetCtrl(c,0);var b=$(".selectorDiv li.init input + label");$(b).addClass("on");$(b).removeClass("off")},getPhoneNum:function(){var d=[];for(var c=0,b=vm.items.length;c<b;c++){d.push(vm.items[c].isHandSet==0?vm.items[c].phone:vm.items[c].mobile)}return d},startMeetingRecord:function(){if(vm.eventId){parent.startRecord(parent.currentPcNum,vm.eventId)}else{parent.startRecord(parent.currentPcNum,"")}}}};a.init();window.page=a});
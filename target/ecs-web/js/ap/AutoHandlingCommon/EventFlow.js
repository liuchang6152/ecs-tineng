var detailUrl=ECS.api.apUrl+"/DisposeWarning/FlowRecord";var vm=new Vue({el:"#main",data:{items:[],selectedItem:[],eventId:"",detail:{}},methods:{returnJson:function(a){return JSON.stringify(a)}}});var EventId=null;$(function(){var a={init:function(){mini.parse();this.bindUI()},table:{},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;a.logic.closeLayer(false)})},data:{source_type:{"0":"手动","1":"电话","2":"自动"},param:{}},logic:{setData:function(b){EventId=b.EventId;a.logic.initPage()},initPage:function(){$.ajax({url:detailUrl+"?eventId="+EventId,type:"get",success:function(d){if(d[0].executedTime){$("#start_time").html(ECS.util.DateTimeRender(d[0].executedTime))}$("#accidentCategoryName").html(d[0].accidentCategoryName?d[0].accidentCategoryName:"");$("#accidentTypeName").html(d[0].accidentTypeName?d[0].accidentTypeName:"");if(d[0].eventSource==1){$("#eventSource").html(d[0].callPhone?d[0].callPhone:"")}else{if(d[0].eventSource==2){var f="";f+=d[0].enterpriseName?d[0].enterpriseName:"";f+=d[0].drtDeptName?d[0].drtDeptName:"";f+=d[0].riskAreaName?d[0].riskAreaName:"";f+=d[0].optlRiskSoneName?d[0].optlRiskSoneName:"";f+=d[0].riskAnlsObjName?d[0].riskAnlsObjName:"";f+=d[0].pointName?d[0].pointName:"";$("#eventSource").html(f)}else{$("#eventSource").html(a.data.source_type[d[0].eventSource])}}$("#riskRankName").html(d[0].riskRankName?d[0].riskRankName:"");$("#eventLvlName").html(d[0].eventLvlName?d[0].eventLvlName:"");$("#eventAddress").html(d[0].eventAddress?d[0].eventAddress:"");if(d[1].executedTime){$("#receive_time").html(ECS.util.DateTimeRender(d[1].executedTime))}if(d[2].executedTime){$("#getcall_time").html(ECS.util.DateTimeRender(d[2].executedTime))}$("#dieCount").html(d[2].dieCount?d[2].dieCount:"无");$("#casualtyCount").html(d[2].casualtyCount?d[2].casualtyCount:"无");$("#propertyLossCount").html(d[2].propertyLossCount?d[2].propertyLossCount:"无");if(d[3].executedTime){$("#dealcall_time").html(ECS.util.DateTimeRender(d[3].executedTime))}var g="";if(d[3].relatedPlanEntityList){for(var b=0;b<d[3].relatedPlanEntityList.length;b++){(function(h){g+='<tr><td class="mini-grid-cell" style="text-align:center;"><div class="mini-grid-cell-inner  mini-grid-cell-nowrap">'+h.emergencyPlanName+'</div></td><td class="mini-grid-cell" style="text-align:center;"><div class="mini-grid-cell-inner  mini-grid-cell-nowrap">'+ECS.util.DateTimeRender(h.usedDate)+"</div></td></tr>"})(d[3].relatedPlanEntityList[b])}$("#case_list").html(g)}var e="";if(d[3].relatedMSDSEntityList){for(var c=0;c<d[3].relatedMSDSEntityList.length;c++){(function(h){e+='<tr><td class="mini-grid-cell" style="text-align:center;"><div class="mini-grid-cell-inner  mini-grid-cell-nowrap">'+h.msdsChineseName+"</div></td></tr>"})(d[3].relatedMSDSEntityList[c])}$("#danger_list").html(e)}if(d[4].executedTime){$("#complete_time").html(ECS.util.DateTimeRender(d[4].executedTime))}if(d[4].alarmTelStatusName){$("#case_status").html(d[4].alarmTelStatusName)}},error:function(b){}})},WFDetail:function(){var b="auto";var c=vm.detail.eventSummary;layer.open({type:1,area:["40%","30%"],offset:b,id:"layerDemo"+b,content:'<div style="padding: 20px 100px;">'+c+"</div>",btn:"关闭",btnAlign:"c",shade:0,yes:function(){layer.closeAll()}})},Detail:function(b){layer.open({type:2,closeBtn:1,area:["80%","80%"],skin:"new-class",shadeClose:false,title:"详情",content:"../FiremanGo/task.html?eventId="+b.eventID+"&teamId="+b.teamID+"&batchId="+b.firemanGoBatch+"&readonly=true&r="+Math.random(),success:function(c,d){},end:function(){}})},Convert:function(b){if(b.alarmTime){b.alarmTime=moment(b.alarmTime).format("YYYY-MM-DD HH:mm:ss")}if(b.initTime){b.initTime=moment(b.initTime).format("YYYY-MM-DD HH:mm:ss")}if(b.commandTime){b.commandTime=moment(b.commandTime).format("YYYY-MM-DD HH:mm:ss")}if(b.registerTime){b.registerTime=moment(b.registerTime).format("YYYY-MM-DD HH:mm:ss")}if(b.completeTime){b.completeTime=moment(b.completeTime).format("YYYY-MM-DD HH:mm:ss")}return b},closeLayer:function(c){var b=parent.layer.getFrameIndex(window.name);parent.layer.close(b)},}};a.init();window.page=a});
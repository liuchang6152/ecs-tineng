var Category_url=ECS.api.bcUrl+"/accidentCategory/list";var Category_url2=ECS.api.bcUrl+"/accidentCategory/accidentType";var riskRank_url=ECS.api.bcUrl+"/riskRank/getListRiskRank";var getOrgIdUrl=ECS.api.bcUrl+"/org/getOrgIdByCode";var getAlarmUrl=ECS.api.apUrl+"/AutomaticMonitoring";var saveAlarmUrl=ECS.api.apUrl+"/DisposeWarning";var getEventUrl=ECS.api.apUrl+"/DirectAlarm/eventLvl";var getCaseUrl=ECS.api.apUrl+"/DisposeWarning/RelatedPlan";var saveCaseUrl=ECS.api.apUrl+"/DisposeWarning/RelatedPlan";var dangerUrl=ECS.api.apUrl+"/DisposeWarning/RelatedMSDS";var saveDangerUrl=ECS.api.apUrl+"/DisposeWarning/RelatedMSDS";var delDangerUrl=ECS.api.apUrl+"/DisposeWarning/RelatedMSDS";var warnEndUrl=ECS.api.apUrl+"/DisposeWarning/complete";var InsertDangerUrl=ECS.api.apUrl+"/DisposeWarning/MSDS";var InsertCaseUrl=ECS.api.apUrl+"/DisposeWarning/emergencyPlan";var InsertAllUrl=ECS.api.apUrl+"/DisposeWarning/gis";var FinishedUrl=ECS.api.apIpVerify+"/status";var EventId="";var IpAdress="";var grid=null;var enterpriseId=null;var drtDeptId=null;var riskAreaId=null;var optlRiskSoneId=null;var riskAnlsObjId=null;var pointId=null;var map_posi=null;var mapchanged=false;var index=parent.layer.getFrameIndex(window.name);window.pageLoadMode=PageLoadMode.None;$(function(){var a={init:function(){var d=a.logic.get_key("eventId");EventId=d?d:"";if(EventId==""){return false}IpAdress=a.logic.get_key("ip");mini.parse();a.logic.set_iframe_h();$(".mini-tabs-body").css("position","relative");$("#callinfo_box").css("left","-"+$("#case_start_t").offsetLeft+"px");var e=$("#tel_get").outerWidth()-$("#posi_set").outerWidth();$("#posi_set,#info_set").css("margin-left",e+"px");ECS.sys.RefreshContextFromSYS();var c=$('<div class="layui-border-box" id="aBtn_list_box" style="text-align: left;"><a href="javascript:;" class="btn btn-default btn-primary mr__5" style="height:30px;line-height:30px;padding:0px;" id="warn_end_btn">处置完成</a><a href="javascript:;" class="btn btn-default btn-close" style="height:30px;line-height:30px;padding:0px;" id="cancel_btn">关闭</a></div>');$(".mini-tabs-headers .mini-tabs-space").css({position:"relative"});c.css({position:"absolute",right:"0px",top:"-5px","text-align":"right",width:"50%",height:"30px"});$(".mini-tabs-headers .mini-tabs-space").append(c);this.bindUI();var b="./../../em/MsgSend/index.html?PageModel=1&eventId="+EventId;$("#sendorder").attr("src",b);$("#pinel_first").parent().css("overflow-y","auto");a.logic.load_EventLevel(function(){a.logic.category_menu(function(){a.logic.category_menu2(function(){a.logic.riskRank_menu(function(){a.logic.get_alarm_message()})})})});a.logic.get_danger_from_factory(function(){a.logic.danger_confirmed_product();a.logic.danger_unconfirmed_product()});a.logic.get_case_from_factory(function(){a.logic.get_start_list();a.logic.get_close_list()});$("#call_situation_box").slideUp()},table:{},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#accidentCategoryId").on("change",function(){a.logic.category_menu2()});$("#btnSave").click(function(){a.logic.save()});$("#dieCount").blur(function(){if($("#dieCount").val()!=""&&$("#dieCount").val()!="无"){var b=a.logic.check_val($("#dieCount").val(),"人员受伤");if(!b){$("#dieCount").val("")}else{layer.confirm("你确认人员受伤是"+this.value+"人吗？",{btn:["确定","取消"]},function(c){layer.close(c)},function(){$("#dieCount").val("")});$("#error_health").hide()}}});$("#casualtyCount").blur(function(){if($("#casualtyCount").val()!=""&&$("#casualtyCount").val()!="无"){var b=a.logic.check_val($("#casualtyCount").val(),"人员死亡");if(!b){$("#casualtyCount").val("")}else{layer.confirm("你确认人员死亡是"+this.value+"人吗？",{btn:["确定","取消"]},function(c){layer.close(c)},function(){$("#casualtyCount").val("")});$("#error_death").hide()}}});$("#propertyLossCount").blur(function(){if($("#propertyLossCount").val()!=""&&$("#propertyLossCount").val()!="无"){var b=a.logic.check_val($("#propertyLossCount").val(),"财产损失");if(!b){$("#propertyLossCount").val("")}else{layer.confirm("你确认财产损失是"+this.value+"万元吗？",{btn:["确定","取消"]},function(c){layer.close(c)},function(){$("#propertyLossCount").val("")});$("#error_money").hide()}}});$("#start_case_btn").click(function(){a.logic.filter_case_list()});$("#eventLvlId").change(function(){$("#EventType_error").hide();if(this.value){var b=$("#eventLvlId option:selected");layer.confirm("你确认事故等级是"+b.text()+"吗？",{btn:["确定","取消"]},function(c){layer.close(c)},function(){$("#eventLvlId").val("")})}});$("#check_case_btn_0").click(function(){a.logic.gotocaselist({planDefinition:0,title:"其它综合预案选项"})});$("#check_case_btn_1").click(function(){a.logic.gotocaselist({planDefinition:1,title:"其它专项预案选项"})});$("#check_case_btn_2").click(function(){a.logic.gotocaselist({planDefinition:2,title:"其它处置预案选项"})});$("#danger_save_btn").click(function(){a.logic.save_danger()});$("#search_danger_btn").click(function(){a.logic.gotodangerlist()});$("#danger_box_0").click(function(b){if(b.target.tagName=="I"){a.logic.remove_danger(b.target)}});$("#mapset_btn").click(function(){a.logic.gotomap()});$(".mini-tabs-space").click(function(b){switch($(b.target).attr("id")){case"warn_end_btn":a.logic.warn_event_end();break;case"cancel_btn":a.logic.closeLayer(index);break}});$("#isVisible_btn").click(function(){if($(this).text()=="展开"){$("#call_situation_box").slideDown();$(this).html("收缩")}else{$("#call_situation_box").slideUp();$(this).html("展开")}});$("#dieCount,#casualtyCount,#propertyLossCount").focus(function(){if($(this).val()=="无"){$(this).val("")}});$("#dieCount,#casualtyCount,#propertyLossCount").blur(function(){if($(this).val()==""){$(this).val("无")}});mini.get("tabs").on("activechanged",function(b){if(b.index==0){$("#aBtn_list_box").show();$("#aBtn_list_box a").show()}else{$("#aBtn_list_box").hide();$("#aBtn_list_box a").hide()}})},data:{param:{}},logic:{adressDetail:function(b){return b.row.riskAreaName+"->"+b.row.optlRiskZoneName+"->"+b.row.riskAnlsobjName},warn_time:function(b){return ECS.util.DateTimeRender(b.row.alertsLogStartTime)},set_iframe_h:function(){var b=$(window).height();var d=$(".box-header").outerHeight();var c=$(".mini-tabs-scrollCt").outerHeight()+52;$("#sendorder,#iframe_map,#iframe_tell,#iframe_PLC").css("height",(b-(d+c))+"px")},setData:function(b){$("#titles").text(b.title);ECS.sys.RefreshContextFromSYS();$("#iframe_map").attr("src",ECS.api.gisserver_url+"/all_zjdxgis/index.html?"+window.btoa(ECS.sys.Context.SYS_ENTERPRISE_CODE))},initTable:function(h,i){var f=i.enterpriseName,c=i.enterpriseId,e=[];for(var d in h){e=h[d]}var g=[];for(var b=0;b<e.length;b++){if(typeof e[b]=="object"){g.push(e[b])}}$("#orgID").html("<option value='"+c+"'>"+f+"</option>");grid=mini.get("datagrid");grid.clearRows();grid.addRows(g)},get_key:function(g){if(window.location.href.indexOf(g)!=-1){var f=window.location.href.split("?")[1];if(f.indexOf("&")==-1){var b=f.split("=");if(b[0]==g){return b[1]}}else{var e=f.split("&");var d="";for(var c=0;c<e.length;c++){(function(i){var h=i.split("=");if(h[0]==g){d=h[1]}})(e[c])}return d}}else{return""}},warn_event_end:function(){$.ajax({url:warnEndUrl+"?eventId="+EventId+"&isFinished=1",async:false,dataType:"text",contentType:"application/json;charset=utf-8",type:"PUT",success:function(b){var b=JSON.parse(b);if(b.isSuccess){a.logic.warn_event_flowClose();layer.msg("结束报警事件成功！",{time:1000},function(){a.logic.closeLayer(index)})}else{layer.msg("结束报警事件失败！")}}})},warn_event_flowClose:function(){$.ajax({url:FinishedUrl+"?orgId="+enterpriseId+"&ip="+IpAdress+"&status=close&now="+Math.random(),async:true,contentType:"application/json;charset=utf-8",type:"GET",success:function(){console.log("结束报警信息")}})},get_alarm_message:function(){var b=getAlarmUrl+"?eventId="+EventId;$.ajax({url:b,type:"GET",success:function(d){$("#riskRankId").val(d.riskRankId);$("#eventLvlId").val(d.eventLvlId);$("#accidentCategoryId").val(d.accidentCategoryId);var c=d.eventSummary?d.eventSummary:"";a.logic.category_menu2(function(){$("#accidentTypeId").val(d.accidentTypeId);c+=(" "+$("#eventLvlId").find("option:selected").text());c+=(" "+$("#accidentCategoryId").find("option:selected").text());c+=(" "+$("#accidentTypeId").find("option:selected").text());$("#eventSummary").html(c)});$("#dieCount").val(d.dieCount?d.dieCount:"无");$("#casualtyCount").val(d.casualtyCount?d.casualtyCount:"无");$("#propertyLossCount").val(d.propertyLossCount?d.propertyLossCount:"无");$("#callPhone").html(d.callPhone?d.callPhone:"无");$("#call_warner").html(d.alertsPersonInfo);$("#eventAddress").val(d.eventAddress?d.eventAddress:"无");enterpriseId=d.enterpriseId;drtDeptId=d.drtDeptId;riskAreaId=d.riskAreaId;optlRiskSoneId=d.optlRiskSoneId;$("#eventAddress").val(d.eventAddress);a.logic.load_fiveseconds_dt(d)}})},load_fiveseconds_dt:function(c){if(c){a.logic.initTable(c.alertsLogEntityMap,{enterpriseName:c.enterpriseName,enterpriseId:c.enterpriseId});setTimeout(function(){a.logic.load_fiveseconds_dt()},5000)}else{var b=getAlarmUrl+"?eventId="+EventId;$.ajax({url:b,type:"GET",timeout:5000,success:function(d){a.logic.initTable(d.alertsLogEntityMap,{enterpriseName:d.enterpriseName,enterpriseId:d.enterpriseId});setTimeout(function(){a.logic.load_fiveseconds_dt()},5000)}})}},check_val:function(f,e){var c=/^\d+(\.\d+)?$/;var d=/^\d+$/;var b=true;switch(e){case"财产损失":if(!c.exec(f)){b=false}break;case"人员受伤":case"人员死亡":if(!d.exec(f)){b=false}break}return b},save:function(){if(!$("#eventLvlId").val()){$("#EventType_error").show();return false}if($("#dieCount").val()!=""&&$("#dieCount").val()!="无"){var c=a.logic.check_val($("#dieCount").val(),"人员受伤");if(!c){$("#error_health").show();return false}else{$("#error_health").hide()}}if($("#casualtyCount").val()!=""&&$("#casualtyCount").val()!="无"){var b=a.logic.check_val($("#casualtyCount").val(),"人员死亡");if(!b){$("#error_death").show();return false}else{$("#error_death").hide()}}if($("#propertyLossCount").val()!=""&&$("#propertyLossCount").val()!="无"){var d=a.logic.check_val($("#propertyLossCount").val(),"财产损失");if(!d){$("#error_money").show();return false}else{$("#error_money").hide()}}var e={};e.eventId=EventId;e.riskRankId=$("#riskRankId").val();e.eventLvlId=$("#eventLvlId").val();e.accidentCategoryId=$("#accidentCategoryId").val();e.accidentTypeId=$("#accidentTypeId").val();e.dieCount=($.trim($("#dieCount").val())==""||$("#dieCount").val()=="无")?"":$("#dieCount").val();e.casualtyCount=($.trim($("#casualtyCount").val())==""||$("#casualtyCount").val()=="无")?"":$("#casualtyCount").val();e.propertyLossCount=($.trim($("#propertyLossCount").val())==""||$("#propertyLossCount").val()=="无")?"":$("#propertyLossCount").val();e.eventAddress=$("#eventAddress").val();e.enterpriseId=enterpriseId;e.drtDeptId=drtDeptId;e.riskAreaId=riskAreaId;e.optlRiskSoneId=optlRiskSoneId;e.riskAnlsObjId=riskAnlsObjId;e.pointId=pointId;$.ajax({url:saveAlarmUrl,async:false,data:JSON.stringify(e),dataType:"text",contentType:"application/json;charset=utf-8",type:"PUT",success:function(f){var f=JSON.parse(f);if(f.isSuccess){layer.msg("报警信息保存成功！");if(mapchanged){a.logic.case_danger_from_factory(function(){a.logic.get_start_list();a.logic.get_close_list();a.logic.danger_confirmed_product();a.logic.danger_unconfirmed_product()})}}else{layer.msg("报警信息保存失败！")}}})},ShowMsDsDetail:function(b,c,d){if(d=="true"){$("#danger_box_1 input").each(function(){if($(this).attr("msdsId")==b){this.checked=true}})}layer.open({type:2,closeBtn:0,area:["80%","80%"],skin:"new-class",shadeClose:false,title:false,content:"./../../rtt/MSDS/detail.html?"+Math.random(),success:function(f,g){var e=layer.getChildFrame("body",g);var i=window[f.find("iframe")[0]["name"]];var h={msdsId:b,title:"查看危化品",pagename:c,ishidden:d};i.page.logic.setData(h)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){a.logic.save_danger()}if(window.pageLoadMode==PageLoadMode.None){if($("#danger_box_1 input:checked").attr("msdsId")==b){$("#danger_box_1 input:checked")[0].checked=false}}}})},save_danger:function(){var d=[];var c=$("#danger_box_1").find("input:checkbox:checked");if(c.length==0){layer.msg("请勾选您想确认的危化品！");return false}for(var b=0;b<c.length;b++){(function(e){var f={};f.relatedMsdsId=$(e).attr("relatedMsdsId");f.eventId=$(e).attr("eventId");f.msdsId=$(e).attr("msdsId");f.isUsed=1;d.push(f)})(c[b])}$.ajax({url:saveDangerUrl,async:false,data:JSON.stringify(d),dataType:"text",contentType:"application/json;charset=utf-8",type:"PUT",success:function(e){var e=JSON.parse(e);if(e.isSuccess){a.logic.danger_confirmed_product();a.logic.danger_unconfirmed_product()}else{layer.msg("相关危化品保存失败！")}}})},gotodangerlist:function(){var b=PageModelEnum.NewAdd,c="危化品信息";layer.open({type:2,closeBtn:0,area:["850px","450px"],skin:"new-class",shadeClose:false,title:false,content:"./../../rtt/MSDS/MSDSModule.html?"+Math.random(),success:function(e,f){var d=layer.getChildFrame("body",f);var h=window[e.find("iframe")[0]["name"]];var g={pageMode:b,eventId:EventId,title:c};h.page.logic.setData(g)},end:function(){a.logic.danger_confirmed_product();a.logic.danger_unconfirmed_product();window.pageLoadMode=PageLoadMode.None}})},remove_danger:function(d){var b=new Array();var c={};c.relatedMsdsId=$(d).attr("relatedMsdsId");c.eventId=$(d).attr("eventId");c.msdsId=$(d).attr("msdsId");c.msdsIds=$(d).attr("msdsIds");c.isUsed=0;b.push(c);$.ajax({url:delDangerUrl,async:false,data:JSON.stringify(b),dataType:"text",contentType:"application/json;charset=utf-8",type:"DELETE",success:function(e){var f=JSON.parse(e);if(f.isSuccess){a.logic.danger_unconfirmed_product();a.logic.danger_confirmed_product()}else{layer.msg("删除失败！")}},error:function(e){var f=$.parseJSON(e.responseText);layer.msg(f.collection.error.message)}})},case_danger_from_factory:function(b){$.ajax({url:InsertAllUrl+"?eventId="+EventId,type:"POST",success:function(c){if(c.isSuccess){b&&b()}}})},get_danger_from_factory:function(b){$.ajax({url:InsertDangerUrl+"?eventId="+EventId,type:"POST",success:function(c){if(c.isSuccess){b&&b()}}})},get_case_from_factory:function(b){$.ajax({url:InsertCaseUrl+"?eventId="+EventId,type:"POST",timeout:5000,success:function(c){if(c.isSuccess){b&&b()}}})},danger_confirmed_product:function(b){var c=$("#danger_box_0");$.ajax({url:dangerUrl+"?eventId="+EventId+"&isUsed=1",type:"GET",timeout:5000,success:function(e){c.html("");for(var d=0;d<e.length;d++){var f=$('<li style="width: 50%;" class="mb__5 pull-left"><span style="cursor:hand;" onclick="page.logic.ShowMsDsDetail(\''+e[d].msdsId+"','"+e[d].msdsChineseName+"','"+false+"')\" >"+e[d].msdsChineseName+'</span><i class="icon-close ml__5" style="color: red;cursor:pointer;" eventId="'+e[d].eventId+'" isUsed="'+e[d].isUsed+'" msdsChineseName="'+e[d].msdsChineseName+'" msdsId="'+e[d].msdsId+'" relatedMsdsId="'+e[d].relatedMsdsId+'" msdsIds="'+e[d].msdsIds+'"></i></li>');c.append(f)}b&&b()}})},danger_unconfirmed_product:function(b){var c=$("#danger_box_1");$.ajax({url:dangerUrl+"?eventId="+EventId+"&isUsed=0",type:"GET",timeout:5000,success:function(e){c.html("");for(var d=0;d<e.length;d++){var f=$('<li style="width: 50%;" class="mb__5 pull-left"><input type="checkbox" class="layui-form-checkbox" style="margin:0px;"  eventId="'+e[d].eventId+'" isUsed="'+e[d].isUsed+'" msdsChineseName="'+e[d].msdsChineseName+'" msdsId="'+e[d].msdsId+'" relatedMsdsId="'+e[d].relatedMsdsId+'" msdsIds="'+e[d].msdsIds+'" /><label class="ml__5" style="cursor:hand;" onclick="page.logic.ShowMsDsDetail(\''+e[d].msdsId+"','"+e[d].msdsChineseName+"','"+true+"')\" >"+e[d].msdsChineseName+"</label></li>");c.append(f)}b&&b()}})},get_start_list:function(){var c=a.logic.case_list_url(1,EventId,0);a.logic.render_start_list(c,$("#start_case_0"));var b=a.logic.case_list_url(1,EventId,1);a.logic.render_start_list(b,$("#start_case_1"));var d=a.logic.case_list_url(1,EventId,2);a.logic.render_start_list(d,$("#start_case_2"))},get_close_list:function(){var c=a.logic.case_list_url(0,EventId,0);a.logic.render_close_list(c,$("#close_case_0"));var b=a.logic.case_list_url(0,EventId,1);a.logic.render_close_list(b,$("#close_case_1"));var d=a.logic.case_list_url(0,EventId,2);a.logic.render_close_list(d,$("#close_case_2"))},case_list_url:function(c,b,d){return getCaseUrl+"?isUsed="+c+"&eventId="+b+"&planDefinition="+d},render_close_list:function(c,d,b){$.ajax({url:c,type:"GET",timeout:5000,success:function(f){d.html("");for(var e=0;e<f.length;e++){var g=$('<li style="width: 50%;" class="mb__5 pull-left"><input type="radio" class="layui-form-radio" name="startPlan" style="margin:0px;" isUsed="'+f[e].isUsed+'" emergencyPlanId="'+f[e].emergencyPlanId+'" emergencyPlanName="'+f[e].emergencyPlanName+'" eventId="'+f[e].eventId+'" planDefinition="'+f[e].planDefinition+'" relatedPlanId="'+f[e].relatedPlanId+'"/><label class="ml__5">'+f[e].emergencyPlanName+"</label></li>");d.append(g)}b&&b()}})},render_start_list:function(c,d,b){$.ajax({url:c,type:"GET",timeout:5000,success:function(f){d.html("");for(var e=0;e<f.length;e++){var g=$('<li style="text-decoration:underline;width:50%;" class="pull-left mb__5"><span>[<span style="color:red;cursor:pointer;" onclick="page.logic.gotosetpage(\''+f[e].emergencyPlanId+"','"+f[e].eventId+"','"+f[e].emergencyPlanName+'\')"  isUsed="'+f[e].isUsed+'" emergencyPlanId="'+f[e].emergencyPlanId+'" emergencyPlanName="'+f[e].emergencyPlanName+'" eventId="'+f[e].eventId+'" planDefinition="'+f[e].planDefinition+'" relatedPlanId="'+f[e].relatedPlanId+'">点击执行</span>]</span> <span>'+f[e].emergencyPlanName+" (启动时间："+ECS.util.DateTimeRender(f[e].usedDate)+")</span></li>");d.append(g)}b&&b()}})},filter_case_list:function(){var c=[];var b=$("#case_close_box").find("input:radio:checked");if(b.length==0){layer.msg("请先勾选您要启动的预案！");return false}layer.open({type:2,closeBtn:0,area:["700px","350px"],skin:"new-class",shadeClose:false,title:false,content:"ShowEmergencyPlan.html?"+Math.random(),success:function(e,f){var d=layer.getChildFrame("body",f);var h=window[e.find("iframe")[0]["name"]];var g={emergencyPlanID:b.attr("emergencyPlanId"),checkMode:true,title:"启动预案"};h.page.logic.setData(g)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){for(var d=0;d<b.length;d++){(function(e){var f={};f.emergencyPlanId=$(e).attr("emergencyPlanId");f.emergencyPlanIds=$(e).attr("emergencyPlanIds");f.emergencyPlanName=$(e).attr("emergencyPlanName");f.eventId=$(e).attr("eventId");f.isUsed=1;f.planDefinition=$(e).attr("planDefinition");f.relatedPlanId=$(e).attr("relatedPlanId");c.push(f)})(b[d])}$.ajax({url:saveCaseUrl,async:false,data:JSON.stringify(c),dataType:"text",contentType:"application/json;charset=utf-8",type:"PUT",success:function(e){window.pageLoadMode=PageLoadMode.None;var e=JSON.parse(e);if(e.isSuccess){a.logic.get_start_list();a.logic.get_close_list()}else{layer.msg("启动预案失败！")}}})}}})},GetOrgId:function(b){$.ajax({url:getOrgIdUrl+"?orgCode="+ECS.sys.Context.SYS_ENTERPRISE_CODE,type:"GET",timeout:5000,success:function(c){orgId=c.orgId;b&&b()}})},load_EventLevel:function(b){$.ajax({url:getEventUrl+"?orgCode="+ECS.sys.Context.SYS_ENTERPRISE_CODE,type:"GET",timeout:5000,success:function(d){$("#eventLvlId").html("");for(var c=0;c<d.length;c++){(function(f){if(f.eventLvlId>0){var e='<option value="'+f.eventLvlId+'">'+f.eventLvlName+"</option>";$("#eventLvlId").append(e)}})(d[c])}b&&b()}})},riskRank_menu:function(b){$.ajax({url:riskRank_url+"?enterpriseCode="+ECS.sys.Context.SYS_ENTERPRISE_CODE,type:"get",success:function(d){$("#riskRankId").html("");for(var c=0;c<d.length;c++){(function(f){var e='<option value="'+f.riskRankID+'">'+f.rankDisplay+"</option>";$("#riskRankId").append(e)})(d[c])}b&&b()}})},category_menu:function(b){$.ajax({url:Category_url,type:"get",success:function(d){$("#accidentCategoryId").html("");for(var c=0;c<d.length;c++){(function(f){var e='<option value="'+f.accidentCategoryID+'">'+f.accidentCategoryName+"</option>";$("#accidentCategoryId").append(e)})(d[c])}b&&b()}})},category_menu2:function(b){if($("#accidentCategoryId").val()){$.ajax({url:Category_url2+"?accidentCategoryID="+$("#accidentCategoryId").val(),type:"get",success:function(d){$("#accidentTypeId").html("");for(var c=0;c<d.length;c++){(function(f){var e='<option value="'+f.accidentTypeID+'">'+f.accidentTypeName+"</option>";$("#accidentTypeId").append(e)})(d[c])}b&&b()}})}else{$("#accidentTypeId").html("");b&&b()}},gotomap:function(){var b=PageModelEnum.View;layer.open({type:2,closeBtn:0,area:["780px","450px"],skin:"new-class",shadeClose:false,title:false,content:"setmap.html?"+Math.random(),success:function(d,e){var c=layer.getChildFrame("body",e);var g=window[d.find("iframe")[0]["name"]];var f={pageMode:b,enterpriseId:enterpriseId,drtDeptId:drtDeptId,riskAreaId:riskAreaId,optlRiskSoneId:optlRiskSoneId,title:"重选报警位置"};g.page.logic.setData(f)},end:function(){if(!map_posi){mapchanged=false;return false}$("#eventAddress").removeAttr("disabled");if($("#eventAddress").val()!=map_posi){$("#eventAddress").val(map_posi);mapchanged=true}else{mapchanged=false}window.pageLoadMode=PageLoadMode.None}})},gotocaselist:function(c){var b=PageModelEnum.View;layer.open({type:2,closeBtn:0,area:["780px","580px"],skin:"new-class",shadeClose:false,title:false,content:"./../../rtt/EmergencyPlan/EmergencyPlan_list.html?"+Math.random(),success:function(e,f){var d=layer.getChildFrame("body",f);var h=window[e.find("iframe")[0]["name"]];var g={pageMode:b,planDefinition:c.planDefinition,EventId:EventId,title:c.title};h.page.logic.setData(g)},end:function(){if(window.pageLoadMode==PageLoadMode.Reload){a.logic.get_start_list();a.logic.get_close_list();window.pageLoadMode=PageLoadMode.None}}})},gotosetpage:function(d,b,e){var c=PageModelEnum.View;layer.open({type:2,closeBtn:0,area:["90%","90%"],skin:"new-class",shadeClose:false,title:false,content:"./../../rtt/EmergencyPlan/StructuredPlan.html?"+Math.random(),success:function(g,h){var f=layer.getChildFrame("body",h);var j=window[g.find("iframe")[0]["name"]];var i={pageMode:c,emergencyPlanID:d,emergencyPlanName:e,eventID:b,IsOnlyRead:true,title:"结构化预案执行"};j.page.logic.setData(i)},end:function(){if(window.pageLoadMode==PageLoadMode.Reload){window.pageLoadMode=PageLoadMode.None}}})},closeLayer:function(b){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(index)}}};a.init();window.page=a});
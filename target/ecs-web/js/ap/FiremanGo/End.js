var sendUrl=ECS.api.apUrl+"/policeProcess/endOfPolice";var eventId="";var pageMode=PageModelEnum.NewAdd;window.pageLoadMode=PageLoadMode.None;$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();$("#inUse").iCheck({checkboxClass:"icheckbox_minimal-blue"});this.bindUI();ECS.sys.RefreshContextFromSYS()},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){b.logic.save()});$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)})},logic:{setData:function(c){eventId=c.eventId},save:function(){var d=ECS.form.getData("AddOrEditModal");b.logic.formValidate();if(!$("#AddOrEditModal").valid()){return}var c={eventId:eventId,handleEndInfo:d.area_Msg};$.ajax({url:sendUrl,async:false,type:"POST",data:JSON.stringify(c),dataType:"json",contentType:"application/json;charset=utf-8",beforeSend:function(){$("#btnSave").attr("disabled","disabled");ECS.showLoading()},success:function(e){ECS.hideLoading();if(e.isSuccess){layer.msg("保存成功！",{time:1000},function(){$("#btnSave").attr("disabled",false)})}else{layer.msg(e.message)}},error:function(e){$("#btnSave").attr("disabled",false);ECS.hideLoading();layer.msg("系统繁忙")}})},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)},formValidate:function(){ECS.form.formValidate("AddOrEditModal",{rules:{area_Msg:{required:true}}})}}};b.init();window.page=b});
mini.parse();mini.get("tree1").on("nodeclick",function(c){var a=mini.get("tree1");var b=a.getSelectedNode();DoStartPlay(b.ResCode)});function CreateEmptyString(c){var b=[];for(var d=0;d<c;d++){b[d]="*"}return b.join("")}function AddList(c,d,b){var a=document.createElement("option");a.appendChild(document.createTextNode(d));a.setAttribute("value",b);c.appendChild(a);return}function FormatTime(c){var b=c.split(" ");var a=b[1].split(":");return b[0]+"%20"+a[0]+"%3A"+a[1]+"%3A"+a[2]}var IS_SHOW_DEBUG=0;var gdownloadID=1;var gdownloadID2=1;function DebugAlert(a){if(IS_SHOW_DEBUG==1){alert(a)}}String.prototype.replaceAll=function(c,b){var a=new String(this);while(a.indexOf(c)!=-1){a=a.replace(c,b)}return a.toString()};function loadXML(a){if(!g_xmlActive){return}g_xmlActive.loadXML(a);if(0==g_xmlActive.parseError.errorCode){return g_xmlActive}else{alert("xml解析错误:"+g_xmlActive.parseError.reason);return null}}function getElementById(d,b){for(var a=0;a<d.childNodes.length;a++){var c=d.childNodes[a];if(c.baseName==b){return c.nodeTypedValue}else{if(c.childNodes.length!=0){getElementById(d.childNodes[a],b)}}}}var g_UserLoginId="";var g_imosActivePlayer=null;var g_curFrameNum="";var g_xmlActive=null;var g_isLogin=1;function InitPage(){g_imosActivePlayer=document.all.h3c_IMOS_ActiveX;g_PlayFrame=document.all.Play_Frame;if(!g_imosActivePlayer){alert("未安装控件，请先安装后再使用本页面")}var a;try{a=new ActiveXObject("Microsoft.XMLDOM");if(!a){a=new ActiveXObject("MSXML2.DOMDocument.3.0")}}catch(d){}g_xmlActive=a;if(!g_xmlActive){alert("xml解析器获取错误，将导致某些功能不可用")}else{g_xmlActive.async="false"}var c=window.setTimeout(b,1000*5);function b(){DoLogin();window.clearTimeout(c)}}function DoLogin(){if(!g_imosActivePlayer){alert("未安装控件，请先安装后再使用本页面");return}var b="10.102.204.103";var d="duijieceshi.tjsh";var c="fdc4a7ab66d91ebf14c2fa9c436184ba";if(c==""){c=""}g_isLogin=g_imosActivePlayer.IMOSAX_InitOCX(b,"8800",d,c,1);if(0!=g_isLogin){alert("IMOSAX_InitOCX Error:"+g_isLogin);return}var e=g_imosActivePlayer.IMOSAX_GetUserLoginInfo();var a=loadXML(e);g_UserLoginId=a.documentElement.selectNodes("//LOGININFO/UserLoginIDInfo/UserLoginCode")[0].text;g_imosActivePlayer.IMOSAX_ChangeLayout(1);g_imosActivePlayer.IMOSAX_ShowToolBar(1,1);DoGetAllCamList()}function DoLogout(){if(!g_imosActivePlayer){alert("未安装控件，请先安装后再使用本页面");return}var a=g_imosActivePlayer.IMOSAX_UnregOCX();if(0!=a){alert("IMOSAX_UnregOCX Error:"+a);return}}function DoStartPlay(d){if(!g_imosActivePlayer){alert("未安装控件，请先安装后再使用本页面");return}var c=g_imosActivePlayer.IMOSAX_StartFrameLive(1,d);var b=c}function DoStopPlay(){if(!g_imosActivePlayer){alert("未安装控件，请先安装后再使用本页面");return}var a=g_imosActivePlayer.IMOSAX_StopFramelive(1);if(0==a){}else{alert("停止实况失败，错误码："+a)}}function DoGetAllCamList(){var l="";l='<?xml version="1.0" ?><data><ItemNum>3</ItemNum><QueryConditionList count="3"><item><QueryType>257</QueryType> <LogicFlag>0</LogicFlag> <QueryData>1</QueryData> </item><item><QueryType>256</QueryType><LogicFlag>0</LogicFlag><QueryData>1001</QueryData></item><item><QueryType>1</QueryType> <LogicFlag>6</LogicFlag><QueryData /> </item></QueryConditionList></data>';var f='<?xml version="1.0" ?> <data><PageRowNum>100</PageRowNum><PageFirstRowNumber>0</PageFirstRowNumber><QueryCount>1</QueryCount></data>';var k="";k=g_imosActivePlayer.IMOSAX_QueryOrgResListEx("iccsid",l,f);var a=new XML.ObjTree();var n=a.parseXML(k);var i=n.result.ResList.item;var b=[];var h=JSLINQ(i).Distinct(function(o){return o.OrgName}).items;for(var g=0;g<h.length;g++){var e=h[g];var d=new Object();d.name=e;d.id=e;d.Pid="";b.push(d);var j=JSLINQ(i).Where(function(o){return o.OrgName==e}).items;var c=new Object();for(var m in j){if(typeof j[m]!="function"){c=j[m].ResItemV1;c.name=c.ResName;c.id=e+Math.random();c.Pid=e;b.push(c)}}}console.log(JSON.stringify(b));mini.get("tree1").loadList(b)}function DoGetAlarmList(){var a="";var c='<?xml version="1.0" ?> <data><PageRowNum>10</PageRowNum><PageFirstRowNumber>0</PageFirstRowNumber><QueryCount>1</QueryCount></data>';var b="";b=g_imosActivePlayer.IMOSAX_QueryAlarmList(a,c);alert(b)}var formatXml=function(d){var f=/(>)(<)(\/*)/g;var s=/ *(.*) +\n/g;var e=/(<.+>)(.+\n)/g;d=d.replace(f,"$1\n$2$3").replace(s,"$1\n").replace(e,"$1\n$2");var q=0;var b="";var a=d.split("\n");var k=0;var p="other";var u={"single->single":0,"single->closing":-1,"single->opening":0,"single->other":0,"closing->single":0,"closing->closing":-1,"closing->opening":0,"closing->other":0,"opening->single":1,"opening->closing":0,"opening->opening":1,"opening->other":1,"other->single":0,"other->closing":-1,"other->opening":0,"other->other":0};for(var o=0;o<a.length;o++){var h=a[o];var t=Boolean(h.match(/<.+\/>/));var g=Boolean(h.match(/<\/.+>/));var m=Boolean(h.match(/<[^!].*>/));var c=t?"single":g?"closing":m?"opening":"other";var r=p+"->"+c;p=c;var l="";k+=u[r];for(var n=0;n<k;n++){l+="\t"}if(r=="opening->closing"){b=b.substr(0,b.length-1)+h+"\n"}else{b+=l+h+"\n"}}return b};if(typeof(XML)=="undefined"){XML=function(){}}XML.ObjTree=function(){return this};XML.ObjTree.VERSION="0.23";XML.ObjTree.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n';XML.ObjTree.prototype.attr_prefix="-";XML.ObjTree.prototype.parseXML=function(c){var b;if(window.DOMParser){var a=new DOMParser();var d=a.parseFromString(c,"application/xml");if(!d){return}b=d.documentElement}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(c);b=a.documentElement}}if(!b){return}return this.parseDOM(b)};XML.ObjTree.prototype.parseHTTP=function(b,j,h){var a={};for(var g in j){a[g]=j[g]}if(!a.method){if(typeof(a.postBody)=="undefined"&&typeof(a.postbody)=="undefined"&&typeof(a.parameters)=="undefined"){a.method="get"}else{a.method="post"}}if(h){a.asynchronous=true;var f=this;var c=h;var d=a.onComplete;a.onComplete=function(l){var k;if(l&&l.responseXML&&l.responseXML.documentElement){k=f.parseDOM(l.responseXML.documentElement)}c(k,l);if(d){d(l)}}}else{a.asynchronous=false}var i;if(typeof(HTTP)!="undefined"&&HTTP.Request){a.uri=b;var e=new HTTP.Request(a);if(e){i=e.transport}}else{if(typeof(Ajax)!="undefined"&&Ajax.Request){var e=new Ajax.Request(b,a);if(e){i=e.transport}}}if(h){return i}if(i&&i.responseXML&&i.responseXML.documentElement){return this.parseDOM(i.responseXML.documentElement)}};XML.ObjTree.prototype.parseDOM=function(a){if(!a){return}this.__force_array={};if(this.force_array){for(var d=0;d<this.force_array.length;d++){this.__force_array[this.force_array[d]]=1}}var c=this.parseElement(a);if(this.__force_array[a.nodeName]){c=[c]}if(a.nodeType!=11){var b={};b[a.nodeName]=c;c=b}return c};XML.ObjTree.prototype.parseElement=function(e){if(e.nodeType==7){return}if(e.nodeType==3||e.nodeType==4){var f=e.nodeValue.match(/[^\x00-\x20]/);if(f==null){return}return e.nodeValue}var b;var d={};if(e.attributes&&e.attributes.length){b={};for(var g=0;g<e.attributes.length;g++){var j=e.attributes[g].nodeName;if(typeof(j)!="string"){continue}var c=e.attributes[g].nodeValue;if(!c){continue}j=this.attr_prefix+j;if(typeof(d[j])=="undefined"){d[j]=0}d[j]++;this.addNode(b,j,d[j],c)}}if(e.childNodes&&e.childNodes.length){var h=true;if(b){h=false}for(var g=0;g<e.childNodes.length&&h;g++){var a=e.childNodes[g].nodeType;if(a==3||a==4){continue}h=false}if(h){if(!b){b=""}for(var g=0;g<e.childNodes.length;g++){b+=e.childNodes[g].nodeValue}}else{if(!b){b={}}for(var g=0;g<e.childNodes.length;g++){var j=e.childNodes[g].nodeName;if(typeof(j)!="string"){continue}var c=this.parseElement(e.childNodes[g]);if(!c){continue}if(typeof(d[j])=="undefined"){d[j]=0}d[j]++;this.addNode(b,j,d[j],c)}}}return b};XML.ObjTree.prototype.addNode=function(c,a,b,d){if(this.__force_array[a]){if(b==1){c[a]=[]}c[a][c[a].length]=d}else{if(b==1){c[a]=d}else{if(b==2){c[a]=[c[a],d]}else{c[a][c[a].length]=d}}}};XML.ObjTree.prototype.writeXML=function(a){var b=this.hash_to_xml(null,a);return this.xmlDecl+b};XML.ObjTree.prototype.hash_to_xml=function(c,b){var f=[];var a=[];for(var e in b){if(!b.hasOwnProperty(e)){continue}var h=b[e];if(e.charAt(0)!=this.attr_prefix){if(typeof(h)=="undefined"||h==null){f[f.length]="<"+e+" />"}else{if(typeof(h)=="object"&&h.constructor==Array){f[f.length]=this.array_to_xml(e,h)}else{if(typeof(h)=="object"){f[f.length]=this.hash_to_xml(e,h)}else{f[f.length]=this.scalar_to_xml(e,h)}}}}else{a[a.length]=" "+(e.substring(1))+'="'+(this.xml_escape(h))+'"'}}var g=a.join("");var d=f.join("");if(typeof(c)=="undefined"||c==null){}else{if(f.length>0){if(d.match(/\n/)){d="<"+c+g+">\n"+d+"</"+c+">\n"}else{d="<"+c+g+">"+d+"</"+c+">\n"}}else{d="<"+c+g+" />\n"}}return d};XML.ObjTree.prototype.array_to_xml=function(b,e){var a=[];for(var c=0;c<e.length;c++){var d=e[c];if(typeof(d)=="undefined"||d==null){a[a.length]="<"+b+" />"}else{if(typeof(d)=="object"&&d.constructor==Array){a[a.length]=this.array_to_xml(b,d)}else{if(typeof(d)=="object"){a[a.length]=this.hash_to_xml(b,d)}else{a[a.length]=this.scalar_to_xml(b,d)}}}}return a.join("")};XML.ObjTree.prototype.scalar_to_xml=function(a,b){if(a=="#text"){return this.xml_escape(b)}else{return"<"+a+">"+this.xml_escape(b)+"</"+a+">\n"}};XML.ObjTree.prototype.xml_escape=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};
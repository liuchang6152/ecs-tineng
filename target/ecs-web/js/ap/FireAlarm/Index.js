var eventUrl=ECS.api.apUrl+"/fileAlarmChild/getTransferPoliceInfo";var historyEventUrl=ECS.api.apUrl+"/fileAlarmChild/getHistoricalEvents";var wf1Url=ECS.api.apUrl+"/fileAlarmChild/getPoliceStatusK";var wfUrl=ECS.api.apUrl+"/fileAlarmChild/getPoliceStatus";var sourceUrl=ECS.api.apUrl+"/fileAlarmChild/getPoliceSource";$(function(){var a={init:function(){mini.parse();this.bindUI();ECS.sys.RefreshContextFromSYS();a.logic.initPage();a.logic.initStatus();a.logic.initWF();a.logic.search();a.logic.search2()},table:{},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btn_alarmDispatching").click(function(){a.logic.alarmDispatching()});$("#btn").click(function(){a.logic.openHO()});$("#btnQuery").click(function(){a.logic.search()});$("#btnQuery2").click(function(){a.logic.search2()})},data:{param:{}},logic:{alarmDispatching:function(){var b="../../html/ap/FireAlarm/AlarmDispatchingIndex.html";window.parent.layerOpen(b,"",function(){a.logic.search();a.logic.search2()},{height:"500px",width:"60%"})},openHO:function(){window.parent.HOstatus=true;var b="../../html/ap/FireAlarm/HO.html";window.parent.layerOpen(b,"",function(){window.parent.HOstatus=false;a.logic.search();a.logic.search2()},{closeBtn:0})},initStatus:function(){},initWF:function(){ECS.ui.getComboSelects(wf1Url,"eventCode","flowCode","flowName",false);ECS.ui.getComboSelects(wfUrl,"eventCode2","flowCode","flowName",false)},initPage:function(){var b=mini.get("eventDatagrid");b.set({url:eventUrl,ajaxType:"GET",dataField:"pageList"});var c=mini.get("historyDatagrid");c.set({url:historyEventUrl,ajaxType:"GET",dataField:"pageList"})},search:function(){a.data.param=ECS.form.getData("searchForm");var c=new mini.Form("searchForm");var d=c.getData();if(d.startTime>d.endTime){layer.msg("开始时间不能大于结束时间");return}var b=mini.get("eventDatagrid");b.load(a.data.param,function(f){$("#lbtotal").text("("+f.total+")")})},search2:function(){a.data.param=ECS.form.getData("searchForm2");var b=new mini.Form("searchForm2");var d=b.getData();if(d.startTime>d.endTime){layer.msg("开始时间不能大于结束时间");return}var c=mini.get("historyDatagrid");c.load(a.data.param)},show_Detail:function(b){return'<a href="javascript:window.page.logic.detail('+b.row.eventId+')">'+b.value+"</a>"},show_edit:function(b){return'<a href="javascript:window.page.logic.WFdetail('+b.row.eventId+')">查看</a>'},detail:function(c){var b=mini.get("eventDatagrid");var e=b.getSelected();var d="../../html/ap/FireAlarm/AO.html?r="+Math.random();if(e.eventSource==0){d="../../html/ap/FireAlarm/HO.html?r="+Math.random()}window.parent.layerOpen(d,c,function(){},{closeBtn:0})},WFdetail:function(b){var c="../../html/ap/FireAlarm/WF.html?r="+Math.random();window.parent.layerOpen(c,b)}}};a.init();window.page=a});
var searchUrl=ECS.api.maUrl+"/alertsLog";var getSingleUrl=ECS.api.maUrl+"/alertsLog";var pageMode=PageModelEnum.NewAdd;window.pageLoadMode=PageLoadMode.None;var alertsLogID="";$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();this.bindUI()},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("#btnQuery").click(function(){b.logic.initEcharts(alertsLogID)});var c=new Date(new Date().getTime()-60*60*1000);var d=ECS.util.timestampToHour(new Date());mini.get("startTime").setValue(ECS.util.timestampToHour(c));mini.get("endTime").setValue(d);mini.get("startTime").on("valuechanged",function(){var e=new Date($("input[name=startTime]").val().replace(/\-/g,"/"));var f=new Date($("input[name=endTime]").val().replace(/\-/g,"/"));if(e>f){mini.get("startTime").setValue(c);layer.msg("开始束时间需早于结束时间！");return false}});mini.get("endTime").on("valuechanged",function(){var e=new Date($("input[name=startTime]").val().replace(/\-/g,"/"));var f=new Date($("input[name=endTime]").val().replace(/\-/g,"/"));if(e>f){mini.get("endTime").setValue(d);layer.msg("结束时间需晚于开始时间！");return false}})},data:{param:{}},logic:{setData:function(c){$("#title-main").text(c.title);alertsLogID=c.alertsLogID;b.logic.initEcharts(c.alertsLogID)},onDrawDate:function(f){var c=f.date;var g=new Date();if(c>g){f.allowSelect=false}},initEcharts:function(h){var f=echarts.init(document.getElementById("main"));f.setOption({title:{y:"30px",text:"指标区间",textStyle:{color:"#7689aa",fontWeight:500,fontSize:14}},grid:{left:150,bottom:30},dataZoom:[{type:"slider",show:true,showDataShadow:false,xAxisIndex:[0],left:150,bottom:0,start:0,end:100}],xAxis:{data:[],show:false},yAxis:{splitLine:{show:true},data:[]},series:[{type:"scatter",label:{normal:{show:true,position:"inside",formatter:function(j){return j.data[0]+"\n\n"+j.data[2]},textStyle:{color:"#768a99"}}},color:"#45c8dc",data:[]}]});var e=[];var d=[];var g=[];var c=[];var i=[];$.ajax({type:"get",async:true,url:getSingleUrl+"/"+h+"?startTime="+ECS.util.timestampToHour(mini.get("startTime").getValue())+"&endTime="+ECS.util.timestampToHour(mini.get("endTime").getValue())+"&now="+Math.random(),dataType:"json",beforeSend:function(){ECS.showLoading()},success:function(k){ECS.hideLoading();if(k){mini.get("datagrid").setData(k.sendMap);for(var n=0;n<k.monitorValueMap.length;n++){i.push(k.monitorValueMap[n].monitorValueLvl);d.push(k.monitorValueMap[n].monitorValueTime);for(var m=0;m<k.factorEntitys.length;m++){var o=[];if(i[n]==k.factorEntitys[m].monitorLvl){if(k.factorEntitys[m].lowLimit==k.factorEntitys[m].uppLimit){k.factorEntitys[m].inUpper="=";k.factorEntitys[m].inLower="="}else{if(k.factorEntitys[m].inUpper==1){k.factorEntitys[m].inUpper="≤"}if(k.factorEntitys[m].inLower==1){k.factorEntitys[m].inLower="≤"}if(k.factorEntitys[m].inUpper==0){k.factorEntitys[m].inUpper="＜"}if(k.factorEntitys[m].inLower==0){k.factorEntitys[m].inLower="＜"}}if(k.factorEntitys[m].uppLimit=="999999.999999"){o.push(ECS.util.DateTimeRendesr(k.monitorValueMap[n].monitorValueTime),i[n]+": "+k.factorEntitys[m].lowLimit+k.factorEntitys[m].inLower+"值",k.monitorValueMap[n].monitorValue)}else{if(k.factorEntitys[m].lowLimit=="-999999.999999"){o.push(ECS.util.DateTimeRendesr(k.monitorValueMap[n].monitorValueTime),i[n]+": 值"+k.factorEntitys[m].inUpper+k.factorEntitys[m].uppLimit,k.monitorValueMap[n].monitorValue)}else{o.push(ECS.util.DateTimeRendesr(k.monitorValueMap[n].monitorValueTime),i[n]+": "+k.factorEntitys[m].lowLimit+k.factorEntitys[m].inLower+"值"+k.factorEntitys[m].inUpper+k.factorEntitys[m].uppLimit,k.monitorValueMap[n].monitorValue)}}c.push(o)}}}var l=[];for(var n=0;n<d.length;n++){if(l.indexOf(d[n])==-1){l.push(ECS.util.DateTimeRendesr(d[n]));l.sort()}}var p=[];for(var m=0;m<k.factorEntitys.length;m++){p.push(k.factorEntitys[m].monitorLvl)}for(var n=0;n<p.length;n++){for(var m=0;m<k.factorEntitys.length;m++){if(p[n]==k.factorEntitys[m].monitorLvl){if(k.factorEntitys[m].lowLimit==k.factorEntitys[m].uppLimit){k.factorEntitys[m].inUpper="=";k.factorEntitys[m].inLower="="}else{if(k.factorEntitys[m].inUpper==1){k.factorEntitys[m].inUpper="≤"}if(k.factorEntitys[m].inLower==1){k.factorEntitys[m].inLower="≤"}if(k.factorEntitys[m].inUpper==0){k.factorEntitys[m].inUpper="＜"}if(k.factorEntitys[m].inLower==0){k.factorEntitys[m].inLower="＜"}if(k.factorEntitys[m].uppLimit=="999999.999999"){k.factorEntitys[m].uppLimit="";k.factorEntitys[m].inUpper=""}if(k.factorEntitys[m].lowLimit=="-999999.999999"){k.factorEntitys[m].inLower="";k.factorEntitys[m].lowLimit=""}}if(k.factorEntitys[m].uppLimit=="999999.999999"){g.push(p[n]+": "+k.factorEntitys[m].lowLimit+k.factorEntitys[m].inLower+"值")}else{if(k.factorEntitys[m].lowLimit=="-999999.999999"){g.push(p[n]+": 值"+k.factorEntitys[m].inUpper+k.factorEntitys[m].uppLimit)}else{g.push(p[n]+": "+k.factorEntitys[m].lowLimit+k.factorEntitys[m].inLower+"值"+k.factorEntitys[m].inUpper+k.factorEntitys[m].uppLimit)}}}}}f.setOption({xAxis:{data:l},yAxis:{data:g},series:[{data:c}]})}},error:function(j){ECS.hideLoading();layer.msg("图表请求数据失败!")}})},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)}}};b.init();window.page=b});
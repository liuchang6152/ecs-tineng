var delUrl=ECS.api.bcUrl+"/alarmLine";var searchUrl=ECS.api.bcUrl+"/alarmLine";var exportUrl=ECS.api.bcUrl+"/alarmLine/ExportToExcel";window.pageLoadMode=PageLoadMode.None;$(function(){var a=1;var b={init:function(){this.bindUI();b.logic.initTable();b.logic.search()},table:{},bindUI:function(){$("#btnAdd").click(function(){b.logic.add($(".active").text())});$("#btnDel").click(function(){b.logic.delAll()});$(".navContent li").click(function(){$(this).addClass("active");$(this).siblings().removeClass("active");a=$(this).index()+1;b.logic.search()});$("#btnExport").click(function(){window.open(exportUrl)});var c=true;$(".btn-toggle").click(function(){if(c){$(".leftNav-body").hide();$(".box-body").css("margin-left","0");$(this).css({left:"0",transform:"rotate(180deg)"})}else{$(".leftNav-body").show();$(".box-body").css("margin-left","202px");$(this).css({left:"185px",transform:"rotate(0deg)"})}c=!c})},data:{param:{}},logic:{initTable:function(){mini.parse();grid=mini.get("datagrid");grid.set({url:searchUrl,ajaxType:"get",dataField:"pageList"})},show_edit:function(c){return ECS.util.editRender(c.row.alarmLineID)},show_riskName:function(c){return'<div title="'+c.row.riskAreaNames+'">'+c.row.alarmLineRiskArea.length+"</div>"},delAll:function(){var c=[];var d=grid.getSelecteds();$.each(d,function(e,f){c.push(f.alarmLineID)});if(c.length==0){layer.msg("请选择要删除的数据!");return}layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){$.ajax({url:delUrl,async:true,data:JSON.stringify(c),dataType:"text",contentType:"application/json;charset=utf-8",type:"DELETE",beforeSend:function(){layer.closeAll();ECS.showLoading()},success:function(e){ECS.hideLoading();if(e.indexOf("collection")<0){layer.msg("删除成功！",{time:1000},function(){grid.reload()})}else{e=JSON.parse(e);layer.msg(e.collection.error.message)}},error:function(e){ECS.hideLoading();var f=$.parseJSON(e.responseText);layer.msg(f.collection.error.message)}})},function(e){layer.close(e)})},add:function(c){var d=PageModelEnum.NewAdd;var e="企业接警专线新增";b.logic.detail(e,"",d,c)},edit:function(c){var d=PageModelEnum.Edit;var e="企业接警专线编辑";b.logic.detail(e,c,d)},detail:function(f,c,e,d){layer.open({type:2,closeBtn:0,area:["800px","440px"],skin:"new-class",shadeClose:false,title:false,content:"AlarmLineAddOrEdit.html?"+Math.random(),success:function(h,i){var g=layer.getChildFrame("body",i);var k=window[h.find("iframe")[0]["name"]];var j={pageMode:e,alarmLineID:c,title:f,typeName:d};k.page.logic.setData(j)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){b.logic.search(true);window.pageLoadMode=PageLoadMode.Refresh}else{if(window.pageLoadMode==PageLoadMode.Reload){b.logic.search(true);window.pageLoadMode=PageLoadMode.Reload}}}})},search:function(c){b.data.param={alarmLineType:a};if(c){b.data.param.sortType=1}grid.load(b.data.param)}}};b.init();window.page=b});
var ECS={};ECS.api={};ECS.ui={};ECS.form={};ECS.util={};ECS.util.Base64={};ECS.sys={};ECS.sys.LoginNameCookieName="LoginName";ECS.sys.TokenCookieName="SYS_CONTEXT_TOKEN";ECS.sys.BearerStartName="Bearer ";ECS.sys.ContextCipherText="";ECS.sys.Context={};$(":input","#searchForm").val("");jQuery(document).bind("ajaxStart",function(){jQuery.support.cors=true;$.ajaxSetup({beforeSend:function(f){if(this.type=="GET"&&this.dataType=="text"){for(var b in this.params){var e=this.params[b];if(e!=undefined&&e!=null&&e.length>99){alert('"'+e.substring(90,99)+'"及其后面的字词均被忽略，因为查询条件单个输入框限制在99个汉字以内。');var a=this.url.indexOf(b);var d=this.url.substring(0,a);var c=this.url.substring(a+b.length+encodeURI(e).length+1);this.url=d+b+"="+encodeURI(e.substring(0,100))+c}}}}})});ECS.showLoading=function(){var a;a='<div class="loading"><div class="loadingTip"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>';$("body").append(a)};ECS.hideLoading=function(){$(".loading").remove()};ECS.util.show_percent=function(f){var e=f+"%";var a=$(".loadFile_box");if(a.length===0){var d=$('<div class="loadFile_box"></div>');var c=$('<div class="loaderfile_percent_box"></div>');var b='<div class="percent_text">'+e+'</div><div class="progress_total"><div class="progress_cur" style="width:'+e+';"></div></div>';c.html(b);$(d).append(c);$("body").append(d)}else{a.find(".percent_text").html(e);a.find(".progress_cur").css("width",e)}a.show()};ECS.util.hide_percent=function(){$(".loadFile_box").hide()};ECS.ui.initBootstrapTable=function(c,a,b){var d={method:"get",url:"",cache:false,pagination:true,pageSize:10,pageNumber:1,pageList:[10,20,50,100],paginationPreText:"<",paginationNextText:">",sidePagination:"server",queryParamsType:"undefined",queryParams:b,undefinedText:"",contentType:"application/x-www-form-urlencoded",formatNoMatches:function(){return""},responseHandler:function(e){var f={pageNumber:e.pageNumber,pageSize:e.pageSize,total:e.total,rows:e.pageList};return f},onLoadSuccess:function(){var e=$("#"+c).find("tbody tr td");$.each(e,function(f,g){$(this).attr("title",$(this).text())})}};$.extend(true,d,a);$("#"+c).bootstrapTable(d)};ECS.ui.initTable=function(a){layui.use(["table","util"],function(){var b=layui.util;var c={even:true,page:{layout:["count","prev","page","next","limit","skip"],theme:"#45c8dc"},request:{pageName:"pageNumber",limitName:"pageSize"},response:{statusName:"status",statusCode:0,countName:"total",dataName:"pageList"}};$.extend(c,a,true);layui.table.render(c)})};ECS.ui.getComboSelect=function(d,a,e,f,c,b){$.ajax({url:d,async:false,dataType:"json",success:function(h){var g=[];if(b){g=[{id:b,text:b}]}$.each(h,function(j,k){if(b!=k[e]){g.push({id:k[e],text:k[f]})}});$("#"+a).select2({tags:c,data:g,language:{noResults:function(i){return"没有匹配项"}}})}})};ECS.ui.getComboSelects=function(c,a,d,e,b){$("#"+a).html('<option value="" selected="selected">可输入</option>');$.ajax({url:c,async:true,dataType:"json",success:function(g){var f=[];$.each(g,function(h,j){f.push({id:j[d],text:j[e]})});$("#"+a).select2({tags:b,data:f,language:{noResults:function(h){return"没有匹配项"}},})},})};ECS.ui.getCombobox=function(b,d,c,f,a){$("#"+b).find("option:selected").text("");$("#"+b).empty();var e={url:d,type:"get",async:true,dataType:"json",contentType:"application/x-www-form-urlencoded",keyField:"key",valueField:"value",codeField:"code",valueSField:"valueSName",selectValue:1,selectFirstRecord:false,showAll:false,limit:20,data:{}};$.extend(true,e,c);$.ajax({url:e.url,type:e.type,async:e.async||false,data:e.data,dataType:e.dataType,contentType:e.contentType,timeout:10000,retryLimit:2,tryCount:0,success:function(g){var i="";var h;$.each(g,function(j,k){if(e.selectFirstRecord===true&&j===0){e.selectValue=k[e.keyField]}if(e.selectFirstRecord===true&&j===1&&(e.selectValue===""||e.selectValue===undefined)){e.selectValue=k[e.keyField]}if(k[e.valueField].length>=e.limit){h=k[e.valueField].substring(0,e.limit)}else{h=k[e.valueField]}i+='<option title="'+k[e.valueField]+'" valueS="'+k[e.valueSField]+'"code="'+k[e.codeField]+'"value="'+k[e.keyField]+'">'+h+"</option>"});$("#"+b).html(i);$("#"+b).val(e.selectValue);if(f){f($("#"+b).val())}$("#"+b).unbind("change");$("#"+b).change(function(){if(a!=null){a($(this).children("option:selected").val())}})},error:function(g,i,h){if(i=="timeout"){this.tryCount++;if(this.tryCount<=this.retryLimit){$.ajax(this);return}return}else{alert("加载Combobox出现了异常:"+h)}}})};ECS.form.setData=function(b,a){if(a==undefined||a==null){return}$("*",document.forms[b]).each(function(f,g){if(g.id.indexOf("$")==-1){var d=$("#"+g.id)}if(d!=undefined&&d!=null){if(g.type=="radio"){if(a[g.id]!=undefined){$("#"+b+"[value="+a[g.id]+"]").attr("checked","checked")}d.trigger("change")}else{if(g.type=="checkbox"){if(a[g.id]==InUseEnum.Yes){d.attr("checked","checked")}else{d.removeAttr("checked")}d.trigger("change")}else{if(g.tagName=="SELECT"){d.val(a[g.id]);d.trigger("change")}else{if(g.tagName=="INPUT"&&g.className!=""&&g.className!=undefined&&g.className.indexOf("bootstrap-treeview")!=-1){var c=$("#dropdown_"+g.id).treeview("getEnabled");for(x in c){if(a[g.id]==c[x].id){$("#dropdown_"+g.id).treeview("selectNode",[c[x].nodeId,{silent:true}]);break}}if($("#dropdown_"+g.id).treeview("getSelected").length!=0){$("#"+g.id).val($("#dropdown_"+g.id).treeview("getSelected")[0].text)}}else{d.val(a[g.id])}}}}}})};ECS.form.getData=function(d){var a={};var c=$("#"+d);if(c==undefined||c==null){return a}$("input",c).each(function(){if(this.name!=undefined&&this.name!=""){a[this.name]=$(this).val()}});$("textarea",c).each(function(){if(this.name!=undefined&&this.name!=""){a[this.name]=$(this).val()}});$("select",c).each(function(){if(this.name!=undefined&&this.name!=""){a[this.name]=$(this).val()}});var e=c.find("[type='checkbox']");if(e!=undefined&&e!=null&&e.length!=0){for(var b=0;b<e.length;b++){if($(e[b]).is(":checked")){a[$(e[b]).attr("name")]=1}else{a[$(e[b]).attr("name")]=0}}}$("div[id^=dropdown_]",c).each(function(){var g=$(this).treeview("getSelected");var f=$(this).treeview(true);if(f.options.multiSelect==false){if(g!=undefined&&g!=null&&g.length!=0){a[$(this).attr("name")]=g[0].id}else{a[$(this).attr("name")]=""}}else{var h=new Array();if(g!=undefined&&g!=null&&g.length!=0){if(f.options.showParentNodes){for(x in g){h.push(g[x].id)}}else{if(!f.options.showParentNodes){for(x in g){if(!g[x].nodes){h.push(g[x].id)}}}}a[$(this).attr("name")]=h}}});return a};ECS.form.formValidate=function(b,a){$("#"+b).validate(a)};ECS.ui.initTreeView=function(c,f,n,p,a,d,g){var o=$("#"+c).outerWidth();var m=$("#"+c).outerHeight();var q=parseInt($("#"+c).css("marginRight"));var h=$("#"+c).position().top;var b=$("#"+c).position().left;$("#"+c).wrap(document.createElement("div"));var k=$("#"+c).css("display");if(k=="inline"){k="inline-block"}$("#"+c).parent().css("position","relative").css("display",k);var e=k=="block"?b:0;var l=$("#"+c).parent().css("display")=="block"?(o-q-22):-q-22;var r=$("#"+c).parent().css("display")=="block"?-(m-6):0;var j=" style='top:"+m+"px;left:"+0+"px;width:"+o+"px;text-align:left;'";var i={async:true,url:f,type:"get",dataType:"json",contentType:"application/x-www-form-urlencoded",data:{},multiSelect:true,showCheckbox:true,onlyLeafCheck:false,showParentNodes:false,disabled:false,selectFirstRecord:false,echo:true,levels:1,color:"#000000",backColor:"#FFFFFF",};$.extend(true,i,d);if(i.echo){$("#"+c).attr("readonly","readonly").css("background-color","white").css("position","relative").parent().append("<i id='down_icon' class='fa fa-chevron-down' style='position:relative;left: "+l+"px;top:"+r+"px;z-index:9999999'></i><div id='dropdown_"+c+"' name='"+c+"' "+j+" class='treeview-dropdown'></div>");$("#"+c).parent().height(m)}if(!i.echo){$("#"+c).append("<div id='dropdown_"+c+"' name='"+c+"' ></div>")}$.ajax({url:i.url,async:i.async,data:i.data,dataType:i.dataType,success:function(t){if(i.echo){var y=ECS.util.toTreeData(t,n,p,a,i.onlyLeafCheck)}if(!i.echo){var y=ECS.util.toMenuTreeData(t,n,p,a,i.onlyLeafCheck)}var u=new Array();var v=new Array();var w;var z=$("#dropdown_"+c).treeview({data:y,showCheckbox:i.showCheckbox,highlightSelected:false,multiSelect:i.multiSelect,showBorder:true,backColor:i.backColor,color:i.color,onhoverColor:"white",levels:i.levels,onlyLeafCheck:i.onlyLeafCheck,showParentNodes:i.showParentNodes,onNodeSelected:function(D,E){if(!i.multiSelect&&!i.showCheckbox){$(this).treeview(true).options.highlightSelected=true;if(w!=undefined&&w.id!=E.id){z.treeview("unselectNode",[w.nodeId,{silent:true}])}w=E;if(i.echo){$("#"+c).val(E.text);$("#dropdown_"+c).hide()}}else{if(i.multiSelect&&i.showCheckbox){z.treeview("checkNode",[E.nodeId,{silent:true}]);if(E.nodes){var A=z.treeview("getChildNodeIdArr",E);for(var C=0;C<A.length;C++){z.treeview("selectNode",[A[C].nodeId,{silent:true}]);z.treeview("checkNode",[A[C].nodeId,{silent:true}])}}z.treeview("setParentNodeCheck",E);var A=z.treeview("getSelected");for(x in A){if(i.showParentNodes&&A[x].nodes&&v.indexOf(A[x].text)==-1){v.push(A[x].text)}if(u.indexOf(A[x].text)==-1&&A[x].nodes==undefined){u.push(A[x].text);u.sort(function(G,F){return G.localeCompare(F)})}}$("#"+c).val(v.concat(u))}}if(g){var B=ECS.ui.initTreeView.getValues(c);g(B,z)}},onNodeUnselected:function(D,E){if(i.multiSelect==false&&i.onlyLeafCheck){if(w.id==E.id){$("#"+c).attr("value",E.text);z.treeview("selectNode",[E.nodeId,{silent:true}])}else{z.treeview("unselectNode",[w.nodeId,{silent:true}]);$("#"+c).val("")}if(i.echo){$("#dropdown_"+c).hide()}return}if(i.multiSelect&&i.showCheckbox){z.treeview("uncheckNode",[E.nodeId,{silent:true}])}if(E.nodes){if(i.showParentNodes){if(v.indexOf(E.text)!==-1){v.splice(v.indexOf(E.text),1)}}var A=z.treeview("getChildNodeIdArr",E);for(var C=0;C<A.length;C++){z.treeview("unselectNode",[A[C].nodeId,{silent:true}]);z.treeview("uncheckNode",[A[C].nodeId,{silent:true}]);if(v.indexOf(A[C].text)!==-1){v.splice(v.indexOf(A[C].text),1)}if(u.indexOf(A[C].text)!==-1){u.splice(u.indexOf(A[C].text),1)}}$("#"+c).val(v.concat(u))}else{if(E.nodes===undefined){if(u.indexOf(E.text)!==-1){u.splice(u.indexOf(E.text),1);$("#"+c).val(v.concat(u))}}}z.treeview("setParentNodeUnCheck",E);if(g){var B=ECS.ui.initTreeView.getValues(c);g(B)}},onNodeChecked:function(D,E){z.treeview("selectNode",[E.nodeId,{silent:true}]);if(E.nodes){var A=z.treeview("getChildNodeIdArr",E);for(var C=0;C<A.length;C++){z.treeview("selectNode",[A[C].nodeId,{silent:true}]);z.treeview("checkNode",[A[C].nodeId,{silent:true}])}}z.treeview("setParentNodeCheck",E);var A=z.treeview("getSelected");for(x in A){if(i.showParentNodes&&A[x].nodes&&v.indexOf(A[x].text)==-1){v.push(A[x].text)}if(u.indexOf(A[x].text)==-1&&A[x].nodes==undefined){u.push(A[x].text);u.sort(function(G,F){return G.localeCompare(F)})}}$("#"+c).val(v.concat(u));if(g){var B=ECS.ui.initTreeView.getValues(c);g(B)}},onNodeUnchecked:function(D,E){if(i.multiSelect){z.treeview("unselectNode",[E.nodeId,{silent:true}])}if(E.nodes){if(i.showParentNodes){if(v.indexOf(E.text)!=-1){v.splice(v.indexOf(E.text),1)}}var A=z.treeview("getChildNodeIdArr",E);for(var C=0;C<A.length;C++){z.treeview("unselectNode",[A[C].nodeId,{silent:true}]);z.treeview("uncheckNode",[A[C].nodeId,{silent:true}]);if(v.indexOf(A[C].text)!=-1){v.splice(v.indexOf(A[C].text),1)}if(u.indexOf(A[C].text)!=-1){u.splice(u.indexOf(A[C].text),1)}}}else{if(E.nodes==undefined){if(u.indexOf(E.text)!=-1){u.splice(u.indexOf(E.text),1)}}}$("#"+c).val(v.concat(u));z.treeview("setParentNodeUnCheck",E);if(g){var B=ECS.ui.initTreeView.getValues(c);g(B)}}});if(i.selectFirstRecord){z.treeview("selectFirstRecord")}if(i.echo){$(window).bind("click",function(E){if(E.target.id==c||E.target.id=="down_icon"){if($(z).css("display")=="block"){$(z).hide();var A=z.treeview("getSelected");var C=new Array();for(var D=0;D<A.length;D++){var B=z.treeview("getChildNodeIdArr",A[D]);if(B.length>1){A.splice(D,1);D--}else{C.push(A[D].id)}}}else{$(z).show()}}else{if((E.target.className.indexOf("list-group-item")==-1)&&(E.target.className.indexOf("check-icon")==-1)&&(E.target.className.indexOf("expand-icon")==-1)&&(E.target.className.indexOf("list-group")==-1)){$(z).hide();var A=z.treeview("getSelected");var C=new Array();for(var D=0;D<A.length;D++){var B=z.treeview("getChildNodeIdArr",A[D]);if(B.length>1){A.splice(D,1);D--}else{C.push(A[D].id)}}}}$("#"+c).attr("title",$("#"+c).val());if(i.disabled){$("#"+c).attr("disabled","disabled").css("background-color","white");return}})}if(!i.selectFirstRecord){z.treeview("echo")}if(!i.echo){var s=$(window).height()-parseInt($("#"+c).css("top"));$(".list-group").css("height",s-30).css("margin","15px")}},error:function(s,u,t){}})};ECS.ui.initTreeView.getValues=function(b){var d=$("#dropdown_"+b).treeview(true);var a=$("#dropdown_"+b).treeview("getSelected");var c=new Array();if(d.options.multiSelect==false){if(a!=undefined&&a!=null&&a.length!=0){c.push(a[0].id)}return c}else{if(a!=undefined&&a!=null&&a.length!=0){if(d.options.showParentNodes){for(x in a){c.push(a[x].id)}}else{if(!d.options.showParentNodes){for(x in a){if(!a[x].nodes){c.push(a[x].id)}}}}return c}}};ECS.util.toTreeData=function(f,a,d,h,e){var j=new Array();for(var c=0;c<f.length;c++){if(f[c][d]==undefined||f[c][d]==null||f[c][d]==0){var b={};b.text=f[c][h];b.id=f[c][a];var g=ECS.util.findTreeChildNodes(f,f[c][a],a,d,h,e);if(g!=null&&g.length!=0){b.nodes=g}if(e&&g!=null&&g.length!=0){b.selectable=false}j.push(b)}}return j};ECS.util.toMenuTreeData=function(f,a,d,h,e){var j=new Array();for(var c=0;c<f.length;c++){if(f[c][d]==undefined||f[c][d]==null||f[c][d]==0){var b={};b.text=f[c][h];b.id=f[c][a];b.originalCode=f[c]["originalCode"];b.type=f[c]["type"];var g=ECS.util.findMenuTreeChildNodes(f,f[c][a],a,d,h,e);if(g!=null&&g.length!=0){b.nodes=g}if(e&&g!=null&&g.length!=0){b.selectable=false}j.push(b)}}return j};ECS.util.findTreeChildNodes=function(h,b,a,f,i,g){var j=new Array();for(var e=0;e<h.length;e++){if(h[e][f]==b){var d={};d.text=h[e][i];d.id=h[e][a];var c=ECS.util.findTreeChildNodes(h,h[e][a],a,f,i,g);if(c!=null&&c.length!=0){d.nodes=c;if(g){d.selectable=false}}j.push(d)}}return j};ECS.util.findMenuTreeChildNodes=function(h,b,a,f,i,g){var j=new Array();for(var e=0;e<h.length;e++){if(h[e][f]==b){var d={};d.text=h[e][i];d.id=h[e][a];d.originalCode=h[e]["originalCode"];d.type=h[e]["type"];var c=ECS.util.findMenuTreeChildNodes(h,h[e][a],a,f,i,g);if(c!=null&&c.length!=0){d.nodes=c;if(g){d.selectable=false}}j.push(d)}}return j};ECS.util.checkDecimalIsValid=function(d,b){var c={length:20,precision:5};$.extend(true,c,b);var e=d;if(e==""||e==null){return false}else{if(isNaN(e)){return false}else{e+="";if((e+"").length>20){return false}var a=e.split(".");if(a.length>1){if(a[0].length<1){return false}if(a[1].length>5){return false}if(a[1].length<1){return false}}}}return true};ECS.util.getTableColumns=function(e){var l=new Array();if(e==null||e==undefined||e.reportColumnList==undefined){return l}var b=e.reportColumnList;var c=new Array();var k=new Array();for(var f=0;f<b.length;f++){var a={};a.title=b[f]["header"]==undefined?b[f]["field"]:b[f]["header"];if(b[f]["field"]!=undefined){a.field=b[f]["field"]}if(b[f]["reportEntityList"]!=null&&b[f]["reportEntityList"]!=undefined&&b[f]["reportEntityList"].length>0){var g=getColSpan(b[f]["reportEntityList"]);if(g!=1){a.colspan=g}for(var d=0;d<b[f]["reportEntityList"].length;d++){k.push(b[f]["reportEntityList"][d])}}else{if(b[f].isHide==InHideEnum.YES){continue}var h=getRowSpan(b);if(h!=1){a.rowspan=h}processColumnInfo(b[f],a)}c.push(a)}l.push(c);if(k.length>0){getTableColumns(k,l)}return l};ECS.util.strToDate=function(a){if(a==undefined){return a}if($.isNumeric(a)){return new Date(a)}if(a instanceof Date){return a}if(a instanceof Object){return a}return new Date(a.replace(/-/g,"/"))};ECS.util.dateFormat=function(c,a){if(!c instanceof Date){return"参数需为日期对象!"}var e={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":c.getHours()%12==0?12:c.getHours()%12,"H+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),S:c.getMilliseconds()};var d={"0":"/u65e5","1":"/u4e00","2":"/u4e8c","3":"/u4e09","4":"/u56db","5":"/u4e94","6":"/u516d"};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length))}if(/(E+)/.test(a)){a=a.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"/u661f/u671f":"/u5468"):"")+d[c.getDay()+""])}for(var b in e){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(e[b]):(("00"+e[b]).substr((""+e[b]).length)))}}return a};ECS.util.extendDate=function(){Date.prototype.dateAdd=function(b,a){var c=this;switch(b){case"s":return new Date(Date.parse(c)+(1000*a));case"n":return new Date(Date.parse(c)+(60000*a));case"h":return new Date(Date.parse(c)+(3600000*a));case"d":return new Date(Date.parse(c)+(86400000*a));case"w":return new Date(Date.parse(c)+((86400000*7)*a));case"q":return new Date(c.getFullYear(),(c.getMonth())+a*3,c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds());case"m":return new Date(c.getFullYear(),(c.getMonth())+a,c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds());case"y":return new Date((c.getFullYear()+a),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds())}}};ECS.util.timestampToTime=function(b){var a=new Date(b);var d=a.getFullYear()+"-";var e=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-";var c=a.getDate()+" ";return d+e+c};ECS.util.timestampToTimes=function(b){var a=new Date(b);var d=a.getFullYear()+"-";var e=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-";var c=a.getDate();return d+e+c};ECS.util.timestampToHour=function(e){var b=new Date(e);var g=b.getFullYear()+"-";var i=(b.getMonth()+1<10?"0"+(b.getMonth()+1):b.getMonth()+1)+"-";var f=(b.getDate()<10?"0"+b.getDate():b.getDate())+" ";var d=(b.getHours()<10?"0"+b.getHours():b.getHours())+":";var a=(b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes())+":";var c=b.getSeconds()<10?"0"+b.getSeconds():b.getSeconds();return g+i+f+d+a+c};function getTableColumns(b,k){var c=new Array();var h=new Array();for(var e=0;e<b.length;e++){var a={};a.title=b[e]["header"]==undefined?b[e]["field"]:b[e]["header"];if(b[e]["field"]!=undefined){a.field=b[e]["field"]}if(b[e]["reportEntityList"]!=null&&b[e]["reportEntityList"]!=undefined&&b[e]["reportEntityList"].length>0){var f=getColSpan(b[e]["reportEntityList"]);if(f!=1){a.colspan=f}for(var d=0;d<b[e]["reportEntityList"].length;d++){h.push(b[e]["reportEntityList"][d])}}else{if(b[e].isHide==InHideEnum.YES){continue}var g=getRowSpan(b);if(g!=1){a.rowspan=g}processColumnInfo(b[e],a)}c.push(a)}k.push(c);if(h.length>0){getTableColumns(h,k)}}function getRowSpan(c){var b=new Array();for(var a=0;a<c.length;a++){window.GROUP_TABLE_ROW_LEVEL=1;if(c[a]["reportEntityList"]!=null&&c[a]["reportEntityList"]!=undefined&&c[a]["reportEntityList"].length>0){getLevelCount(c[a]["reportEntityList"])}b.push(window.GROUP_TABLE_ROW_LEVEL)}return Math.max.apply(Math,b)}function getLevelCount(b){for(var a=0;a<b.length;a++){if(b[a]["reportEntityList"]!=null&&b[a]["reportEntityList"]!=undefined&&b[a]["reportEntityList"].length>0){++window.GROUP_TABLE_ROW_LEVEL;getLevelCount(b[a]["reportEntityList"])}}}function getColSpan(c){window.GROUP_TABLE_COLSPAN_COUNT=0;var d=new Array();for(var b=0;b<c.length;b++){if(c[b]["reportEntityList"]!=null&&c[b]["reportEntityList"]!=undefined&&c[b]["reportEntityList"].length>0){for(var a=0;a<c[b]["reportEntityList"].length;a++){d.push(c[b]["reportEntityList"][a])}}else{++window.GROUP_TABLE_COLSPAN_COUNT}}if(d.length>0){getColSpanCount(d)}return window.GROUP_TABLE_COLSPAN_COUNT}function getColSpanCount(c){var d=new Array();for(var b=0;b<c.length;b++){if(c[b]["reportEntityList"]!=null&&c[b]["reportEntityList"]!=undefined&&c[b]["reportEntityList"].length>0){for(var a=0;a<c[b]["reportEntityList"].length;a++){d.push(c[b]["reportEntityList"][a])}}else{++window.GROUP_TABLE_COLSPAN_COUNT}}if(d.length>0){getColSpanCount(d)}}function processColumnInfo(b,a){if(b.isEdit==IsEditEnum.TRUE){if(b.controlType==ControlTypeEnum.ComboBox){a.edit="select";a.templet=function(d){var c=this.field+"_SHOWNAME";return d[c]||""}}else{if(b.controlType==ControlTypeEnum.Date){a.edit="date"}else{if(b.controlType==ControlTypeEnum.DateTime){a.edit="datetime"}else{a.edit="text"}}}if(b.dataType==DataTypeEnum.Date){a.dataType="date"}else{if(b.dataType==DataTypeEnum.DateTime){a.dataType="datetime"}else{if(b.dataType==DataTypeEnum.Number){a.dataType="number"}else{a.dataType="text"}}}}if(b.align==AlignEnum.Left){a.align="left"}else{if(b.align==AlignEnum.Right){a.align="right"}else{a.align="center"}}}ECS.util.Base64.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";ECS.util.Base64.base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);ECS.util.Base64.utf16to8=function(e){var b,d,a,f;b="";a=e.length;for(d=0;d<a;d++){f=e.charCodeAt(d);if((f>=1)&&(f<=127)){b+=e.charAt(d)}else{if(f>2047){b+=String.fromCharCode(224|((f>>12)&15));b+=String.fromCharCode(128|((f>>6)&63));b+=String.fromCharCode(128|((f>>0)&63))}else{b+=String.fromCharCode(192|((f>>6)&31));b+=String.fromCharCode(128|((f>>0)&63))}}}return b};ECS.util.Base64.utf8to16=function(g){var b,e,a,h;var f,d;b="";a=g.length;e=0;while(e<a){h=g.charCodeAt(e++);switch(h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=g.charAt(e-1);break;case 12:case 13:f=g.charCodeAt(e++);b+=String.fromCharCode(((h&31)<<6)|(f&63));break;case 14:f=g.charCodeAt(e++);d=g.charCodeAt(e++);b+=String.fromCharCode(((h&15)<<12)|((f&63)<<6)|((d&63)<<0));break}}return b};ECS.util.Base64.base64encode=function(g){var c,e,a;var f,d,b;a=g.length;e=0;c="";while(e<a){f=g.charCodeAt(e++)&255;if(e==a){c+=ECS.util.Base64.base64EncodeChars.charAt(f>>2);c+=ECS.util.Base64.base64EncodeChars.charAt((f&3)<<4);c+="==";break}d=g.charCodeAt(e++);if(e==a){c+=ECS.util.Base64.base64EncodeChars.charAt(f>>2);c+=ECS.util.Base64.base64EncodeChars.charAt(((f&3)<<4)|((d&240)>>4));c+=ECS.util.Base64.base64EncodeChars.charAt((d&15)<<2);c+="=";break}b=g.charCodeAt(e++);c+=ECS.util.Base64.base64EncodeChars.charAt(f>>2);c+=ECS.util.Base64.base64EncodeChars.charAt(((f&3)<<4)|((d&240)>>4));c+=ECS.util.Base64.base64EncodeChars.charAt(((d&15)<<2)|((b&192)>>6));c+=ECS.util.Base64.base64EncodeChars.charAt(b&63)}return c};ECS.util.Base64.base64decode=function(h){var g,f,d,b;var e,a,c;a=h.length;e=0;c="";while(e<a){do{g=ECS.util.Base64.base64DecodeChars[h.charCodeAt(e++)&255]}while(e<a&&g===-1);if(g===-1){break}do{f=ECS.util.Base64.base64DecodeChars[h.charCodeAt(e++)&255]}while(e<a&&f===-1);if(f===-1){break}c+=String.fromCharCode((g<<2)|((f&48)>>4));do{d=h.charCodeAt(e++)&255;if(d===61){return c}d=ECS.util.Base64.base64DecodeChars[d]}while(e<a&&d===-1);if(d===-1){break}c+=String.fromCharCode(((f&15)<<4)|((d&60)>>2));do{b=h.charCodeAt(e++)&255;if(b===61){return c}b=ECS.util.Base64.base64DecodeChars[b]}while(e<a&&b===-1);if(b===-1){break}c+=String.fromCharCode(((d&3)<<6)|b)}return c};ECS.util.getCookie=function(c){if(document.cookie.length>0){var b=document.cookie.indexOf(c+"=");if(b!==-1){b=b+c.length+1;var a=document.cookie.indexOf(";",b);if(a===-1){a=document.cookie.length}return unescape(document.cookie.substring(b,a))}}return""};ECS.util.setCookie=function(f,e,d){var a=30;var c=a*24*60*60*1000;if(d&&parseInt(d)){c=d}var b=new Date();b.setTime(b.getTime()+c);document.cookie=f+"="+encodeURI(e)+";expires="+b.toGMTString()};ECS.util.DateRender=function(b){if(b.value){var a=new Date(b.value)}else{var a=new Date(b)}if(a){return mini.formatDate(a,"yyyy-MM-dd")}return a};ECS.util.DateTimeRender=function(b){if(b.value){var a=new Date(b.value)}else{var a=new Date(b)}if(a){return mini.formatDate(a,"yyyy-MM-dd HH:mm:ss")}return a};ECS.util.DateTimeRendesr=function(b){if(b.value){var a=new Date(b.value)}else{var a=new Date(b)}if(a){return mini.formatDate(a,"yyyy-MM-dd\nHH:mm:ss")}return a};ECS.util.editRender=function(b,a){switch(arguments.length){case 2:return'<a title="编辑" href="javascript:window.page.logic.edit(\''+b+"','"+a+'\')"><i class="icon-edit edit"></i></a>';break;case 1:return'<a title="编辑" href="javascript:window.page.logic.edit('+b+')"><i class="icon-edit edit"></i></a>';break}};ECS.util.editRenderer=function(b){var a=b.record._uid;return'<a title="编辑" href="javascript:window.page.logic.edit('+a+')"><i class="icon-edit edit"></i></a>'};ECS.util.renderer=function(f,g,c,b){c=c===undefined?"key":c;b=b===undefined?"value":b;for(var d=0,a=g.length;d<a;d++){if(g[d][c]===f.value){return g[d][b]}}return""};ECS.util.ReturnTypeName=function(b){var a={"1":"静态业务点","2":"应急队伍点","3":"应急物资存放点","4":"视频点","5":"实时监测点","6":"静态线","8":"静态面","11":"企业","12":"二级单位","13":"安全风险区","14":"作业风险区","15":"风险分析对象"};return a[b]};ECS.util.renderUploader_Page=function(b,e,a,c,d){layer.open({type:2,closeBtn:0,area:["800px","450px"],skin:"new-class",shadeClose:false,title:false,content:"../../bc/Attachment/index.html?"+Math.random(),success:function(g,h){var f=layer.getChildFrame("body",h);var j=window[g.find("iframe")[0]["name"]];var i={enterpriseCode:b,name:a,srcType:c,srcRef:e,title:d};j.page.logic.setData(i)},end:function(){page.logic.search(true)}})};ECS.util.detail=function(a,b){a=$.extend({width:860,height:500,unit:"px"},a);layer.open({type:2,closeBtn:0,area:[a.width+a.unit,a.height+a.unit],skin:"new-class",shadeClose:false,title:false,content:a.url+"?r="+Math.random(),success:function(c,d){var e=window[c.find("iframe")[0]["name"]];if(e.page.logic.setData){e.page.logic.setData(a.data)}},end:function(){if(b){b()}}})};ECS.util.addOrEdit=function(c,a,b){c=$.extend({async:true,pageMode:PageModelEnum.NewAdd},c);$.ajax({url:c.url,async:c.async,type:c.pageMode==PageModelEnum.NewAdd?"POST":"PUT",data:JSON.stringify(c.data),dataType:"text",contentType:"application/json;charset=utf-8",beforeSend:function(){ECS.showLoading()},success:function(d){ECS.hideLoading();if(a){a(d)}else{if(d.indexOf("collection")<0){layer.msg(d,{time:1000},function(){page.logic.closeLayer(true)})}else{layer.msg(d.collection.error.message)}}},error:function(d){ECS.hideLoading();if(b){b(d)}else{var e=$.parseJSON(d.responseText);layer.msg(e.collection.error.message)}}})};ECS.util.del=function(h,b,c){h=$.extend({async:true},h);var e;var f=[];var g=h.grid.getSelecteds();for(var d=0,a=g.length;d<a;d++){f.push(g[d][h.idField])}if(f.length===0){layer.msg("请选择要删除的数据!");return}if(h.delArrKey!=null){e={};e[h.delArrKey]=f}layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){$.ajax({url:h.url,async:h.async,data:h.data!=null?h.data:h.delArrKey!=null?JSON.stringify(e):JSON.stringify(f),dataType:"text",timeout:1000,contentType:"application/json;charset=utf-8",type:"DELETE",beforeSend:function(){ECS.showLoading()},success:function(i){ECS.hideLoading();if(b){b(i)}else{if(i.indexOf("collection")<0){layer.msg("删除成功！",{time:1000},function(){h.grid.reload()})}else{i=JSON.parse(i);layer.msg(i.collection.error.message)}}},error:function(i){ECS.hideLoading();if(c){c()}else{var j=$.parseJSON(i.responseText);layer.msg(j.collection.error.message)}}})},function(i){layer.close(i)})};ECS.util.bindCmb=function(c,d,a){c=$.extend({async:true,idField:"key",textField:"value",isTree:false,pIdField:"pid"},c);var b=mini.get(c.ctrId);$.ajax({async:c.async,url:c.url,type:"GET",data:c.data,success:function(e){b.setValueField(c.idField);b.setTextField(c.textField);if(c.isTree){b.loadList(e,c.idField,c.pIdField)}else{b.setData(e)}if(d){d(e)}},error:function(f){console.log(f)}});if(a){b.on("valuechanged",function(f){a(f)})}};ECS.util.pingServer=function(){$.ajax({async:true,url:"../../../js/common/p.js",type:"GET",success:function(a){console.log(a)},error:function(a){console.log(a)}})};jQuery(document).bind("ajaxSend",function(e,d,b){if(b.global===false){return}var a=ECS.sys.getTokenFromSYS();if(a){var f=b.headers||{};f.Authorization=ECS.sys.BearerStartName+a;d.setRequestHeader("Authorization",ECS.sys.BearerStartName+a);b.headers=f;var c=b.headers||{};c.SYS_CONTEXT_CIPHERTEXT=ECS.sys.ContextCipherText;d.setRequestHeader("SYS_CONTEXT_CIPHERTEXT",ECS.sys.ContextCipherText);b.headers=c}});jQuery(document).bind("error",function(c,b,a,d){var f=localStorage.getItem("userName")||"";if(a.global===false){return}var e=a.headers||{};e.ns=f;b.setRequestHeader("ns",f);a.headers=e});ECS.sys.isHQ=function(a){return a===ECS.sys.hq_code};ECS.sys.getTokenFromSYS=function(){return ECS.util.getCookie(ECS.sys.TokenCookieName)};ECS.sys.getLoginNameFromSYS=function(){if($(".box-header")){var a=$(document.body).outerHeight();var b=$(".box-header").outerHeight()+32+15;$(".box-main > .box-body").css("min-height",(a-b)+"px");a=null;b=null}var c=ECS.util.getCookie(ECS.sys.LoginNameCookieName);if(c===undefined||c===""){c="ecs002"}return c};ECS.sys.RefreshContextFromSYS=function(){var b=ECS.sys.getLoginNameFromSYS();var a=ECS.api.commonUrl+"/getSysContext";$.ajax({url:a,async:false,data:{loginName:b},dataType:"text",contentType:"application/json;charset=utf-8",type:"GET",success:function(c){if(c){ECS.sys.ContextCipherText=c;var d=ECS.util.Base64.base64decode(c);var e=ECS.util.Base64.utf8to16(d);ECS.sys.Context=JSON.parse(e);localStorage.setItem("gisOrgCode",ECS.sys.Context.SYS_ENTERPRISE_CODE)}else{}},error:function(c){}})};ECS.util.importExcel=function(b,a,e,c,d){layer.open({type:2,closeBtn:0,area:["80%","60%"],skin:"new-class",shadeClose:false,title:false,content:c,success:function(g,h){var f=layer.getChildFrame("body",h);var j=window[g.find("iframe")[0]["name"]];var i={pageMode:PageModelEnum.NewAdd,title:"导入",url:b,exportUrl:a,confirmUrl:e};j.page.logic.setData(i)},end:function(){page.logic.search();if(!pageflag){ECS.util.ExportExcel(a,redisKey)}else{if(d){d()}}}})};ECS.util.ExportExcel=function(b,a){layer.confirm("数据错误，是否导出？",{btn:["确定","取消"]},function(e){layer.close(e);var d=b+"?redisKey="+a;var f=$("<form>");f.attr("style","display:none");f.attr("target","");f.attr("method","get");f.attr("action",d);var c=$("<input>");c.attr("type","hidden");c.attr("name","redisKey");c.attr("value",a);$("body").append(f);f.append(c);f.submit();var g=setInterval(function(){if(window.document.readyState!="loading"){try{clearTimeout(g)}catch(h){}}},3000)},function(c){layer.close(c)})};
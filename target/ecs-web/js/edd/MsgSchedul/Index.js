var teamUrl=ECS.api.eddUrl+"/eddSchedul/getTeams";var dutyUrl=ECS.api.eddUrl+"/eddSchedul/dutyNames";var searchUrl=ECS.api.eddUrl+"/eddSchedul/page";var enterpriseCodeUrl=ECS.api.bcUrl+"/org/porgName?orgLvl=2&isAll=true";var delUrl=ECS.api.eddUrl+"/eddSchedul";var exportUrl=ECS.api.eddUrl+"/eddSchedul/ExportToExcel";var teamIdUrl=ECS.api.apUrl+"/policeProcess/getUserTeamId";pageflag=true;redisKey="";window.pageLoadMode=PageLoadMode.None;var enterpriseCode="";var teamId;$(function(){var a={init:function(){mini.parse();this.bindUI();a.logic.initTable();a.logic.search();a.logic.InitTeam(teamUrl,"teamId");a.logic.Initduty(dutyUrl,"dutyName")},table:{},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;a.logic.closeLayer(false)});$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnImp").click(function(){a.logic.imp()});$("#btnExport").click(function(){var c=new mini.Form("searchForm");var d=c.getData();if(d.startTime>d.endTime){layer.msg("开始时间不能大于结束时间");return}a.data.param=ECS.form.getData("searchForm");var b=a.logic.setUrlK(a.data.param);window.open(exportUrl+"?"+b)});$("#btnQuery").click(function(){a.logic.search()});$("#btnDel").click(function(){a.logic.delAll()})},data:{param:{}},logic:{setUrlK:function(f){var d="",b,c;for(var e in f){if(f.hasOwnProperty(e)){b=e}c=f[e];d+="&"+b+"="+encodeURIComponent(c)}return d.substring(1,d.length)},InitTeam:function(b,c){ECS.ui.getComboSelects(b,"teamId","teamID","teamName",false);$.ajax({url:teamIdUrl,type:"get",contentType:"application/json;charset=utf-8",success:function(d){if(d.result){if(d.result.teamId){teamId=d.result.teamId;$("#btnExport").attr("disabled",false)}}},error:function(d){}})},Initduty:function(b,c){ECS.ui.getComboSelects(b,"dutyName","name","name",false)},setData:function(b){$("#title-main").text(b.title);a.logic.search();pageMode=b.pageMode;if(pageMode==PageModelEnum.NewAdd){return}},initTable:function(){mini.parse();grid=mini.get("datagrid")},show_edit:function(b){if(b.row.isTeam){return ECS.util.editRender(b.row.commGroupTypeId,b.row.enterpriseCode)}},search:function(){var b=new mini.Form("searchForm");var c=b.getData();if(c.startTime>c.endTime){layer.msg("开始时间不能大于结束时间");return}a.data.param=ECS.form.getData("searchForm");grid.set({url:searchUrl,ajaxType:"get",dataField:"pageList"});grid.load(a.data.param);$("#personnelName").val("")},delAll:function(){var b=[];var c=grid.getSelecteds();$.each(c,function(d,e){b.push({schedulId:e.schedulId})});if(b.length==0){layer.msg("请选择要删除的数据!");return}layer.confirm("确定删除吗？",{btn:["确定","取消"]},function(){$.ajax({url:delUrl,async:true,data:JSON.stringify(b),dataType:"json",timeout:1000,contentType:"application/json;charset=utf-8",type:"DELETE",success:function(d){if(d.isSuccess){layer.msg("删除成功！",{time:1000},function(){grid.reload()})}else{layer.msg(d.message)}},error:function(d){var e=$.parseJSON(d.responseText);layer.msg(e.collection.error.message)}})},function(d){layer.close(d)})},add:function(){var b=PageModelEnum.NewAdd;var c="通讯组新增";a.logic.detail(c,"","",b)},edit:function(d,b){var c=PageModelEnum.Edit;var e="编辑值班人员";a.logic.detail(e,d,b,c)},detail:function(h,e,b,d){var g;if(d==PageModelEnum.Edit){var f=mini.get("datagrid").getSelected();g=f.commGroupTypeName}var c=grid.getSelected();layer.open({type:2,closeBtn:0,area:["80%","90%"],skin:"new-class",shadeClose:false,title:false,content:"Edit.html?"+Math.random(),success:function(j,k){var i=layer.getChildFrame("body",k);var m=window[j.find("iframe")[0]["name"]];var l={pageMode:d,title:h};if(d==PageModelEnum.Edit){}m.page.logic.setData(l,c)},end:function(){if(window.pageLoadMode==PageLoadMode.Refresh){a.logic.search(true);window.pageLoadMode=PageLoadMode.None}else{if(window.pageLoadMode==PageLoadMode.Reload){a.logic.search(true);window.pageLoadMode=PageLoadMode.None}}}})},closeLayer:function(b){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(index)},imp:function(){var c=ECS.api.eddUrl+"/eddSchedul/importExcel";var b=ECS.api.eddUrl+"/eddSchedul/ExportExcel";var e=ECS.api.eddUrl+"/eddSchedul/importAddAll";var d="../../bc/UploadFile/UploadFile.html?"+Math.random();ECS.util.importExcel(c,b,e,d)}}};a.init();window.page=a});
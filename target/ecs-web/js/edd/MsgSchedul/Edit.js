var addUrl=ECS.api.eddUrl+"/eddSchedul";var riskAreaTypeNameUrl=ECS.api.bcUrl+"/org/porgName";var constitutionUrl=ECS.api.rttUrl+"/team/getListByParam?param=constitutionName";var teamPIDNameUrl=ECS.api.rttUrl+"/team/getListByParam?param=teamPIDName";var teamTypeIDUrl=ECS.api.rttUrl+"/team/getListByParam?param=teamType&isAll=true";var teamLvlUrl=ECS.api.rttUrl+"/team/getListByParam?param=teamLvl&isAll=true";var teamSpecialityUrl=ECS.api.rttUrl+"/team/getListByParam?param=teamSpeciality&isAll=true";var teamTypeUrl=ECS.api.rttUrl+"/expert/getExpertTypeEnumList";var pageMode=PageModelEnum.NewAdd;window.pageLoadMode=PageLoadMode.None;var oid="";$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){mini.parse();$("#inUse").iCheck({checkboxClass:"icheckbox_minimal-blue"});$("#teamBaseLvl").iCheck({checkboxClass:"icheckbox_minimal-blue"});this.bindUI();ECS.sys.RefreshContextFromSYS()},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){b.logic.save()});$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("#selectOwner").click(function(){b.logic.selectOwner("应急处置人员选择",PageModelEnum.Details)})},logic:{setData:function(e,c){ECS.form.setData("AddOrEditModal",c);var d=new mini.Form("AddOrEditModal");d.setData(c,false);mini.get("selfId").setValue(c.personnelId);mini.get("startTime").setEnabled(false);mini.get("endTime").setEnabled(false);$("#title-main").text(e.title);pageMode=e.pageMode;if(pageMode==PageModelEnum.NewAdd){}else{}},selectOwner:function(d,c){layer.open({type:2,closeBtn:0,area:["700px","100%"],skin:"new-class",shadeClose:false,title:false,content:"SelectPersons.html?"+Math.random(),success:function(f,g){var e=layer.getChildFrame("body",g);var i=window[f.find("iframe")[0]["name"]];var h={pageMode:c,title:d+"(单选)",multiSelect:false};i.page.logic.setData(h)},end:function(){if(window.ownDetail){var e=JSON.parse(window.ownDetail[0].data);$("#personnelName").val(e.name);$("#dutyName").val(e.dutyType);$("#userMobile").val(e.userMobile);$("#userPhone").val(e.userPhone);$("#teamName").val(e.teamName);$("#selfId").val(e.selfId)}}})},save:function(){b.logic.formValidate();if(!$("#AddOrEditModal").valid()){return}var d=ECS.form.getData("AddOrEditModal");var c={schedulId:$("#schedulId").val(),personnelId:$("#selfId").val()};var e="POST";if(pageMode==PageModelEnum.NewAdd){window.pageLoadMode=PageLoadMode.Reload}else{if(pageMode==PageModelEnum.Edit){e="PUT";window.pageLoadMode=PageLoadMode.Refresh}}$.ajax({url:addUrl,async:false,type:e,data:JSON.stringify(c),dataType:"json",contentType:"application/json;charset=utf-8",beforeSend:function(){$("#btnSave").attr("disabled","disabled");ECS.showLoading()},success:function(f){ECS.hideLoading();if(f.isSuccess){layer.msg("保存成功！",{time:1000},function(){b.logic.closeLayer(true)})}else{layer.msg(f.message)}},error:function(f){$("#btnSave").attr("disabled",false);ECS.hideLoading();var g=$.parseJSON(f.responseText);layer.msg(g.collection.error.message)}})},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)},formValidate:function(){ECS.form.formValidate("AddOrEditModal",{rules:{}})}}};b.init();window.page=b});
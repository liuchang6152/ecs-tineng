var searchUrl=ECS.api.eddUrl+"/eddSchedul";var searcVehiclehUrl=ECS.api.rttUrl+"/vehicle/getListByOrgId";var presentJeevesUrl=ECS.api.eddUrl+"/EDDPresentJeeves/all?&pageSize=9999&pageIndex=0";var updateUrl=ECS.api.rttUrl+"/vehicle/updateStatus";var vm=new Vue({el:"#main",data:{items:[],vehicles:[],presentJeeves:[]},methods:{gernerateId:function(a){return"sp_"+a},gernerateSelId:function(a){return"sel_"+a},isShow:function(a){if(a&&a.length>0){return true}return false},mouseout:function(){layer.close(vm.tips)},mouseover:function(a,f){if(!a){return}var e="";for(var b=0;b<a.length;b++){var d=a[b];e=e+"<div class='col-xs-4'>";e=e+" <label class='control-label'>"+d.systemName+"</label>";e=e+"  </div>";e=e+"<div class='col-xs-4'>";e=e+" <label class='control-label'>"+d.relevantModuleCh+"</label>";e=e+"  </div>";e=e+"<div class='col-xs-4'>";e=e+" <label class='control-label'>"+d.priority+"</label>";e=e+"  </div>"}var c="<div style='text-align: center;  class='form-horizontal'> <div class='row' > <div class='col-xs-12'> <div class='form-group'> <div class='col-xs-4'> <label class='control-label'>系统分类</label>  </div>  <div class='col-xs-4' > <label class='control-label'>相关部件</label>  </div>  <div class='col-xs-4' > <label class='control-label'>故障等级</label>  </div>"+e+"  </div>  </div>  </div>";vm.tips=layer.tips(c,"#"+f,{area:["400px","auto"],time:0,tips:[1,"#c00"]})},}});$(function(){var a={init:function(){ECS.sys.RefreshContextFromSYS();a.logic.PersonArr();a.logic.VehicleArr();a.logic.PresentJeevesArr();mini.parse();this.bindUI()},table:{},bindUI:function(){$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;a.logic.closeLayer(false)});$("#btnDetail").click(function(){a.layerAlter("Index.html?","值班表维护")});$("#btnVehicleDetail").click(function(){a.layerAlter("../../../html/rtt/Vehicle/index.html?","应急车辆")});$("#btnPresentJeevesDetail").click(function(){a.layerAlter("../PresentJeeves/index.html?","占道维护")})},data:{param:{}},layerAlter:function(b,c){layer.open({type:2,skin:"layui-layer-rim",area:["80%","70%"],content:b+Math.random(),title:c})},template:function(d,b){var c=b==1?d.userMobile:d.userPhone;window.parent.call(c)},logic:{initTable:function(){},callMobile:function(b){a.template(b,1)},callPhone:function(b){a.template(b,2)},noneClick:function(){},Status:function(c){if(c.abnormalStatus==1){var b="auto";var d="存在异常";layer.open({type:1,offset:b,id:"layerDemo"+b,content:'<div style="padding: 20px 100px;">'+d+"</div>",btn:"关闭",btnAlign:"c",shade:0,yes:function(){layer.closeAll()}})}},VehicleClick:function(c){var b=c.vehicleID;$("#sel_"+b).val(c.poactionStatus);$("#sp_"+b).toggle();$("#sel_"+b).toggle()},Vehiclechange:function(c){var b=c.vehicleID;$("#sp_"+b).toggle();$("#sel_"+b).toggle();var d={vehicleID:c.vehicleID,poactionStatus:$("#sel_"+b).val()};$.ajax({url:updateUrl+"?vehicleID="+c.vehicleID+"&poactionStatus="+$("#sel_"+b).val(),async:false,type:"PUT",data:{},dataType:"json",contentType:"application/json;charset=utf-8",success:function(e){if(e.isSuccess){a.logic.VehicleArr()}layer.msg(e.message)},error:function(e){layer.msg(e.responseText)}})},PersonArr:function(){$.ajax({url:searchUrl,type:"get",success:function(b){vm.items=b},error:function(b){}})},VehicleArr:function(){$.ajax({url:searcVehiclehUrl+"?orgCode="+ECS.sys.Context.SYS_ENTERPRISE_CODE,type:"get",success:function(b){vm.vehicles=b},error:function(b){}})},PresentJeevesArr:function(){$.ajax({url:presentJeevesUrl,type:"get",success:function(b){vm.presentJeeves=a.logic.Convert(b.pageList)},error:function(b){}})},Convert:function(b){b.forEach(function(c){c.noticeDate=moment(c.noticeDate).format("YYYY-MM-DD ");c.startDate=moment(c.startDate).format("YYYY-MM-DD ");c.endDate=moment(c.endDate).format("YYYY-MM-DD ")});return b}}};a.init();window.page=a});
var orgNameUrl=ECS.api.eddUrl+"/eddSchedul/tree";var enterpriseCodeUrl=ECS.api.emUrl+"/CommGroups/porgName?orgLvl=1";var pageMode=PageModelEnum.Details;window.pageLoadMode=PageLoadMode.None;var multiSelect=false;$(function(){var a=parent.layer.getFrameIndex(window.name);var b={init:function(){ECS.sys.RefreshContextFromSYS();mini.parse();b.logic.initOrgName(orgNameUrl,"#tree1");b.logic.select_option();this.bindUI()},bindUI:function(){$("input").blur(function(){$(this).val($.trim($(this).val()))});$("#btnSave").click(function(){b.logic.save()});$(".btnClose").click(function(){window.pageLoadMode=PageLoadMode.None;b.logic.closeLayer(false)});$("#add").click(function(){b.logic.moveAdd()});$("#remove").click(function(){b.logic.moveRemove()})},logic:{select_option:function(){$.ajax({url:enterpriseCodeUrl,type:"get",success:function(d){mini.get("enterpriseCode").loadList(d,"orgCode","porgCode");if(ECS.sys.Context.SYS_IS_HQ){mini.get("enterpriseCode").setValue(d[0].orgCode)}else{enterpriseCode=ECS.sys.Context.SYS_ENTERPRISE_CODE;mini.get("enterpriseCode").disable();for(var c=0;c<d.length;c++){(function(e){if(e.orgCode==ECS.sys.Context.SYS_ENTERPRISE_CODE){mini.get("enterpriseCode").setValue(e.orgCode)}})(d[c])}}},error:function(c){}})},setData:function(c){$("#title-main").text(c.title);pageMode=c.pageMode;multiSelect=c.multiSelect;$("#grid2 p").click(function(){$(this).siblings("p").removeClass("selected");$(this).addClass("selected")})},initOrgName:function(c,d){$.ajax({url:c+"?orgCode="+ECS.sys.Context.SYS_ENTERPRISE_CODE,type:"get",beforeSend:function(){ECS.showLoading()},success:function(e){ECS.hideLoading();mini.get(d).loadList(e,"selfId","pid")},error:function(e){ECS.hideLoading();var f=$.parseJSON(e.responseText);layer.msg(f.collection.error.message)}})},moveAdd:function(){var h=mini.get("tree1").getSelectedNode();var l=h.userMobile;var d=h.userPhone;var k=h.dutyType;var j=h.teamName;var n=h.name;var g=h.userId;var m=JSON.stringify(h);var c=false;var f=$("#grid2 p");for(var e=0;e<$("#grid2 p").length;e++){if(h.userID==f[e].id){c=true}}if(!c){if(!multiSelect){$("#grid2").empty()}$("#grid2").append("<p data='"+m+"' name='"+n+"' id='"+g+"'>"+n+"</p>")}$("#grid2 p").click(function(){$(this).siblings("p").removeClass("selected");$(this).addClass("selected")})},moveRemove:function(){$(".selected").remove()},onDrawNode:function(f){var c=f.sender;var d=f.node.userId;if(d==null){f.iconCls="mini-tree-folder"}else{f.iconCls="mini-tree-user"}},beforenodeselect:function(d){var c=d.node.userId;if(d.node.userId==null){d.cancel=true}},search:function(){var c=mini.get("key").getValue();if(c==""){mini.get("tree1").clearFilter()}else{c=c.toLowerCase();mini.get("tree1").filter(function(d){var e=d.name?d.name:"";if(e.indexOf(c)!=-1){return true}})}},save:function(){var e=[];if($("#grid2 p").length>0){for(var c=0;c<$("#grid2 p").length;c++){var d={};d.userId=$("#grid2 p").eq(c).attr("id");d.userName=$("#grid2 p").eq(c).attr("name");d.data=$("#grid2 p").eq(c).attr("data");e.push(d)}}parent.ownDetail=e;b.logic.closeLayer(true)},closeLayer:function(c){window.parent.pageLoadMode=window.pageLoadMode;parent.layer.close(a)},}};b.init();window.page=b});
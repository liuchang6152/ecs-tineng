$(function(){var a=parent.layer.getFrameIndex(window.name);var b={presentJeevesUrl:ECS.api.eddUrl+"/EDDPresentJeeves",init:function(){mini.parse();this.bindUI()},bindUI:function(){$(".btnClose").click(function(){b.logic.closeLayer(false)});$("#btnSave").click(function(){b.logic.save()})},data:{param:{}},logic:{setData:function(e){$("#title-main").text(e.title);b.data.param.pageMode=e.pageMode;b.data.param.id=e.id;var c=mini.get("mtrlType");c.setData(e.typeData);c.select(0);if(e.pageMode!=PageModelEnum.NewAdd){var d=new mini.Form("AddOrEditModal");$.ajax({url:b.presentJeevesUrl+"/"+e.id,type:"get",async:true,dataType:"json",beforeSend:function(){ECS.showLoading()},success:function(f){f.noticeDate=ECS.util.strToDate(f.noticeDate);f.startDate=ECS.util.strToDate(f.startDate);f.endDate=ECS.util.strToDate(f.endDate);f.mtrlType=f.mtrlType===""||f.mtrlType===null?-1:f.mtrlType;d.setData(f);$("#address").val(f.address);ECS.hideLoading()},error:function(f){ECS.hideLoading();var g=$.parseJSON(f.responseText);layer.msg(g.collection.error.message)}})}},save:function(){b.logic.formValidate();if(!$("#AddOrEditModal").valid()){return}var c=ECS.form.getData("AddOrEditModal");c.mtrlType=c.mtrlType==-1?"":c.mtrlType;ECS.util.addOrEdit({url:b.presentJeevesUrl,data:c,pageMode:b.data.param.pageMode},function(d){layer.msg(d,{time:1000},function(){parent.page.logic.search();b.logic.closeLayer(true)})})},closeLayer:function(c){parent.layer.close(a)},formValidate:function(){ECS.form.formValidate("AddOrEditModal",{ignore:"",rules:{startDate:{required:true},endDate:{required:true},noticeDate:{required:true},address:{required:true}}})}}};b.init();window.page=b});
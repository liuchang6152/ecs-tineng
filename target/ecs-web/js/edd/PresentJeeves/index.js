var exportUrl=ECS.api.eddUrl+"/EDDPresentJeeves/ExportToExcel";pageflag=true;redisKey="";$(function(){var a={presentJeevesUrl:ECS.api.eddUrl+"/EDDPresentJeeves",typeUrl:ECS.api.rttUrl+"/vehicle/vehicleTypeList",typeData:[],init:function(){mini.parse();a.bindUI();a.logic.initType();a.logic.search()},table:{},bindUI:function(){$("#btnAdd").click(function(){a.logic.add()});$("#btnDel").click(function(){a.logic.del()});$("#btnQuery").click(function(){a.logic.search()});$("#btnReset").click(function(){a.logic.reset()});$("#btnImp").click(function(){a.logic.imp()});$("#btnExport").click(function(){var c=new mini.Form("searchForm");var d=c.getData();if(d.startDate>d.endDate){layer.msg("开始时间不能大于结束时间");return}d.startDate=mini.formatDate(d.startDate,"yyyy-MM-dd");d.endDate=mini.formatDate(d.endDate,"yyyy-MM-dd");var b=a.logic.setUrlK(a.data.param);window.open(exportUrl+"?"+b)})},data:{param:{}},logic:{setUrlK:function(f){var d="",b,c;for(var e in f){if(f.hasOwnProperty(e)){b=e}c=f[e];d+="&"+b+"="+encodeURIComponent(c)}return d.substring(1,d.length)},initType:function(){$.ajax({async:false,url:a.typeUrl,type:"get",success:function(b){a.typeData=b},error:function(b){console.log(b)}});a.typeData.insert(0,{key:-1,value:"请选择"});mini.get("mtrlType").setData(a.typeData);mini.get("mtrlType").select(0)},search:function(){var c=new mini.Form("searchForm");var d=c.getData();if(d.startDate>d.endDate){layer.msg("开始时间不能大于结束时间");return}var b=mini.get("datagrid");b.set({url:a.presentJeevesUrl,ajaxType:"get",dataField:"pageList"});d.startDate=mini.formatDate(d.startDate,"yyyy-MM-dd");d.endDate=mini.formatDate(d.endDate,"yyyy-MM-dd");b.load(d)},add:function(){ECS.util.detail({url:"addOrEdit.html",data:{title:"新增占道维护",pageMode:PageModelEnum.NewAdd,typeData:a.typeData}})},edit:function(b){var c=mini.get("datagrid").getRowByUid(b);ECS.util.detail({url:"addOrEdit.html",data:{title:"编辑占道维护",pageMode:PageModelEnum.Edit,typeData:a.typeData,id:c.presentJeevesId}})},del:function(){ECS.util.del({url:a.presentJeevesUrl,grid:mini.get("datagrid"),idField:"presentJeevesId"})},reset:function(){mini.get("startDate").setValue("");mini.get("endDate").setValue("");mini.get("mtrlType").select(0)},renderer_mtrlType:function(c){var b=a.typeData;return ECS.util.renderer(c,b)},imp:function(){var c=ECS.api.eddUrl+"/EDDPresentJeeves/importExcel";var b=ECS.api.eddUrl+"/EDDPresentJeeves/ExportExcel";var e=ECS.api.eddUrl+"/EDDPresentJeeves/importAddAll";var d="../../bc/UploadFile/UploadFile.html?"+Math.random();ECS.util.importExcel(c,b,e,d)}}};a.init();window.page=a});